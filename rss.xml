<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lehoon</title>
  
  <link href="/rss.xml" rel="self"/>
  
  <link href="http://blog.lehoon.cn/"/>
  <updated>2016-08-23T00:48:48.600Z</updated>
  <id>http://blog.lehoon.cn/</id>
  
  <author>
    <name>lehoon</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>kafka在window下部署</title>
    <link href="http://blog.lehoon.cn/backend/2016/08/22/kafka-window.html"/>
    <id>http://blog.lehoon.cn/backend/2016/08/22/kafka-window.html</id>
    <published>2016-08-22T03:29:06.000Z</published>
    <updated>2016-08-23T00:48:48.600Z</updated>
    
    <content type="html">&lt;p&gt;kafka在window下部署记录。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;一、环境&lt;br&gt;window 7 64位&lt;br&gt;jdk 1.7&lt;br&gt;kafka:2.10-0.10.0.1 (&lt;a href=&quot;http://mirrors.cnnic.cn/apache/kafka/0.10.0.1/kafka_2.10-0.10.0.1.tgz&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://mirrors.cnnic.cn/apache/kafka/0.10.0.1/kafka_2.10-0.10.0.1.tgz&lt;/a&gt;)&lt;br&gt;下载后，解压到指定的目录下，例如：D:\home\kafka_2.10-0.10.0.1&lt;/p&gt;
&lt;p&gt;二、修改配置文件&lt;br&gt;1、修改kafka_2.10-0.10.0.1\config\log4j.properties中的kafka.logs.dir 为/tmp。&lt;br&gt;2、复制kafka_2.10-0.10.0.1\config\server.properties 为server-9093.properties,然后修改新文件的内容，主要关注2点broker.id、listeners、log.dirs修改内容如下：&lt;br&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;broker.id=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;listeners=&lt;span class=&quot;string&quot;&gt;PLAINTEXT:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//:9093&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;log.dirs=&lt;span class=&quot;regexp&quot;&gt;/tmp/&lt;/span&gt;kafka-logs&lt;span class=&quot;number&quot;&gt;-9093&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;3、复制kafka_2.10-0.10.0.1\config\server.properties 为server-9094.properties，然后修改新文件的内容，主要关注2点broker.id、listeners、log.dirs修改内容如下：&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;broker.id=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;listeners=&lt;span class=&quot;string&quot;&gt;PLAINTEXT:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//:9094&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;log.dirs=&lt;span class=&quot;regexp&quot;&gt;/tmp/&lt;/span&gt;kafka-logs&lt;span class=&quot;number&quot;&gt;-9094&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;三、修改启动脚本文件&lt;br&gt;把kafka_2.10-0.10.0.1\bin目录下的.sh文件，删除掉。把kafka_2.10-0.10.0.1\bin\window文件夹下的拷贝到kafka_2.10-0.10.0.1\bin目录下，然后做相应的修改如下：&lt;br&gt;1、修改zookeeper-server-start.bat文件中的%~dp0../../为%~dp0/../。&lt;br&gt;&lt;figure class=&quot;highlight dos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;@&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; off&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Licensed to the Apache Software Foundation (ASF) under one or more&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem contributor license agreements.  See the NOTICE file distributed with&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem this work for additional information regarding copyright ownership.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem The ASF licenses this file to You under the Apache License, Version 2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem (the &quot;License&quot;); you may not use this file except in compliance with&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem the License.  You may obtain a copy of the License at&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem     http://www.apache.org/licenses/LICENSE-2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Unless required by applicable law or agreed to in writing, software&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem See the License for the specific language governing permissions and&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem limitations under the License.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wmic process where (commandline like &quot;&lt;span class=&quot;variable&quot;&gt;%%z&lt;/span&gt;ookeeper&lt;span class=&quot;variable&quot;&gt;%%&quot;&lt;/span&gt; and &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; name=&quot;wmic.exe&quot;) delete&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;2、修改kafka-server-start.bat文件中的%~dp0../../为%~dp0/../。&lt;br&gt;&lt;figure class=&quot;highlight dos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;@&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; off&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Licensed to the Apache Software Foundation (ASF) under one or more&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem contributor license agreements.  See the NOTICE file distributed with&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem this work for additional information regarding copyright ownership.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem The ASF licenses this file to You under the Apache License, Version 2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem (the &quot;License&quot;); you may not use this file except in compliance with&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem the License.  You may obtain a copy of the License at&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem     http://www.apache.org/licenses/LICENSE-2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Unless required by applicable law or agreed to in writing, software&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem See the License for the specific language governing permissions and&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem limitations under the License.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [%&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; USAGE: %&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; server.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;EXIT&lt;/span&gt; /B &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;SetLocal&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_LOG4J_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_LOG4J_OPTS=-Dlog4j.configuration=file:%~dp0../config/log4j.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_HEAP_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_HEAP_OPTS=-Xmx1G -Xms1G&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;%~dp0kafka-run-class.bat kafka.Kafka %*&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;EndLocal&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;3、修改kafka-run-class.bat文件中的pushd %~dp0..\ 为 pushd %~dp0..\&lt;br&gt;    修改通过for循环添加jar到classpath的代码部分为&lt;br&gt;&lt;figure class=&quot;highlight dos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Classpath addition for kafka-core dependencies&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%%i&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;%BASE_DIR%&lt;/span&gt;\libs\*.jar) &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;call&lt;/span&gt; :concat &lt;span class=&quot;variable&quot;&gt;%%i&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;文件修改后为：&lt;br&gt;&lt;figure class=&quot;highlight dos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;119&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;120&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;121&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;122&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;123&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;124&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;125&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;126&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;127&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;128&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;129&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;130&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;131&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;132&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;133&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;134&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;@&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; off&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Licensed to the Apache Software Foundation (ASF) under one or more&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem contributor license agreements.  See the NOTICE file distributed with&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem this work for additional information regarding copyright ownership.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem The ASF licenses this file to You under the Apache License, Version 2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem (the &quot;License&quot;); you may not use this file except in compliance with&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem the License.  You may obtain a copy of the License at&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem     http://www.apache.org/licenses/LICENSE-2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Unless required by applicable law or agreed to in writing, software&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem See the License for the specific language governing permissions and&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem limitations under the License.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;setlocal&lt;/span&gt; enabledelayedexpansion&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [%&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; USAGE: %&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; classname [opts]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;EXIT&lt;/span&gt; /B &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Using pushd popd to set BASE_DIR to the absolute path&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;pushd&lt;/span&gt; %~dp0..\&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; BASE_DIR=&lt;span class=&quot;variable&quot;&gt;%CD%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;popd&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%BASE_DIR%&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%SCALA_VERSION%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; SCALA_VERSION=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%SCALA_BINARY_VERSION%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; SCALA_BINARY_VERSION=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Classpath addition for kafka-core dependencies&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%%i&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;%BASE_DIR%&lt;/span&gt;\libs\*.jar) &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;call&lt;/span&gt; :concat &lt;span class=&quot;variable&quot;&gt;%%i&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem JMX settings&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_JMX_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_JMX_OPTS=-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false  -Dcom.sun.management.jmxremote.ssl=false&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem JMX port to use&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%JMX_PORT%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;NEQ&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_JMX_OPTS=&lt;span class=&quot;variable&quot;&gt;%KAFKA_JMX_OPTS%&lt;/span&gt; -Dcom.sun.management.jmxremote.port=&lt;span class=&quot;variable&quot;&gt;%JMX_PORT%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Log directory to use&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%LOG_DIR%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; LOG_DIR=&lt;span class=&quot;variable&quot;&gt;%BASE_DIR%&lt;/span&gt;/logs&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Log4j settings&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_LOG4J_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_LOG4J_OPTS=-Dlog4j.configuration=file:&lt;span class=&quot;variable&quot;&gt;%BASE_DIR%&lt;/span&gt;/config/tools-log4j.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;) &lt;span class=&quot;keyword&quot;&gt;ELSE&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  # create logs directory&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;exist&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%LOG_DIR%&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%LOG_DIR%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_LOG4J_OPTS=-Dkafka.logs.&lt;span class=&quot;built_in&quot;&gt;dir&lt;/span&gt;=&lt;span class=&quot;variable&quot;&gt;%LOG_DIR%&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%KAFKA_LOG4J_OPTS%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Generic jvm settings you want to add&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_OPTS=&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; DEFAULT_JAVA_DEBUG_PORT=&lt;span class=&quot;number&quot;&gt;5005&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; DEFAULT_DEBUG_SUSPEND_FLAG=n&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem Set Debug options if enabled&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_DEBUG%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;NEQ&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%JAVA_DEBUG_PORT%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; JAVA_DEBUG_PORT=&lt;span class=&quot;variable&quot;&gt;%DEFAULT_JAVA_DEBUG_PORT%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%DEBUG_SUSPEND_FLAG%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; DEBUG_SUSPEND_FLAG=&lt;span class=&quot;variable&quot;&gt;%DEFAULT_DEBUG_SUSPEND_FLAG%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; DEFAULT_JAVA_DEBUG_OPTS=-agentlib:jdwp=transport=dt_socket,server=y,suspend=&lt;span class=&quot;variable&quot;&gt;!DEBUG_SUSPEND_FLAG!&lt;/span&gt;,address=&lt;span class=&quot;variable&quot;&gt;!JAVA_DEBUG_PORT!&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%JAVA_DEBUG_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; JAVA_DEBUG_OPTS=&lt;span class=&quot;variable&quot;&gt;!DEFAULT_JAVA_DEBUG_OPTS!&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; Enabling Java debug options: &lt;span class=&quot;variable&quot;&gt;!JAVA_DEBUG_OPTS!&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_OPTS=&lt;span class=&quot;variable&quot;&gt;!JAVA_DEBUG_OPTS!&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;!KAFKA_OPTS!&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Which java to use&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%JAVA_HOME%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; JAVA=java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;) &lt;span class=&quot;keyword&quot;&gt;ELSE&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; JAVA=&quot;&lt;span class=&quot;variable&quot;&gt;%JAVA_HOME%&lt;/span&gt;/bin/java&quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem Memory options&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_HEAP_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_HEAP_OPTS=-Xmx256M&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rem JVM performance options&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%KAFKA_JVM_PERFORMANCE_OPTS%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; KAFKA_JVM_PERFORMANCE_OPTS=-server -XX:+UseG1GC -XX:MaxGCPauseMillis=&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt; -XX:InitiatingHeapOccupancyPercent=&lt;span class=&quot;number&quot;&gt;35&lt;/span&gt; -XX:+DisableExplicitGC -Djava.awt.headless=true&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%CLASSPATH%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; Classpath is empty. Please build the project first e.g. by running &#39;gradlew jarAll&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;EXIT&lt;/span&gt; /B &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; COMMAND=&lt;span class=&quot;variable&quot;&gt;%JAVA%&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%KAFKA_HEAP_OPTS%&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%KAFKA_JVM_PERFORMANCE_OPTS%&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%KAFKA_JMX_OPTS%&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%KAFKA_LOG4J_OPTS%&lt;/span&gt; -cp &lt;span class=&quot;variable&quot;&gt;%CLASSPATH%&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;%KAFKA_OPTS%&lt;/span&gt; %*&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem echo.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem echo %COMMAND%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;rem echo.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;%COMMAND%&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;goto&lt;/span&gt; :eof&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;:concat&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;IF&lt;/span&gt; [&quot;&lt;span class=&quot;variable&quot;&gt;%CLASSPATH%&lt;/span&gt;&quot;] &lt;span class=&quot;keyword&quot;&gt;EQU&lt;/span&gt; [&quot;&quot;] (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; CLASSPATH=&quot;%&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;) &lt;span class=&quot;keyword&quot;&gt;ELSE&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; CLASSPATH=&lt;span class=&quot;variable&quot;&gt;%CLASSPATH%&lt;/span&gt;;&quot;%&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;四、启动zookeeper&lt;br&gt;打开window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;zookeeper-server-start&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.bat&lt;/span&gt; ..\&lt;span class=&quot;selector-tag&quot;&gt;config&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;zookeeper&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.properties&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;提出创建成功，如果出现错误，请根据错误提示修改直到可以运行即可。&lt;/p&gt;
&lt;p&gt;五、启动kafka&lt;br&gt;打开window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight axapta&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;kafka-&lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;-start.bat ..\config\&lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9093.&lt;/span&gt;properties&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在新开一个window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight axapta&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;kafka-&lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;-start.bat ..\config\&lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9094.&lt;/span&gt;properties&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这就启动了2个kafka的broker节点。&lt;br&gt;如果出现错误，请根据错误做相应的修改。&lt;/p&gt;
&lt;p&gt;六、创建topic&lt;br&gt;打开window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;kafka-topics&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.bat&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--create&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--zookeeper&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:2181&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--replication-factor&lt;/span&gt; 2 &lt;span class=&quot;selector-tag&quot;&gt;--partitions&lt;/span&gt; 3 &lt;span class=&quot;selector-tag&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;my-test-topic&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;D&lt;/span&gt;:\&lt;span class=&quot;selector-tag&quot;&gt;home&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;kafka_2&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10-0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;Created&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;topic&lt;/span&gt; &quot;&lt;span class=&quot;selector-tag&quot;&gt;my-test-topic&lt;/span&gt;&quot;.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;提出创建成功.&lt;/p&gt;
&lt;p&gt;七、查看topic信息&lt;br&gt;打开window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;D&lt;/span&gt;:\home\kafka_2.&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;0.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;0.1&lt;/span&gt;\bin&amp;gt;kafka-topics.bat --describe --zookeeper &lt;span class=&quot;attribute&quot;&gt;localhost&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt; --topic my-test-topic&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;D&lt;/span&gt;:\home\kafka_2.&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;0.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;0.1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;Topic&lt;/span&gt;:my-test-topic       &lt;span class=&quot;attribute&quot;&gt;PartitionCount&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;        &lt;span class=&quot;attribute&quot;&gt;ReplicationFactor&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;Configs&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attribute&quot;&gt;Topic&lt;/span&gt;: my-test-topic      &lt;span class=&quot;attribute&quot;&gt;Partition&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;    &lt;span class=&quot;attribute&quot;&gt;Leader&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;       &lt;span class=&quot;attribute&quot;&gt;Replicas&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;   &lt;span class=&quot;attribute&quot;&gt;Isr&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attribute&quot;&gt;Topic&lt;/span&gt;: my-test-topic      &lt;span class=&quot;attribute&quot;&gt;Partition&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;    &lt;span class=&quot;attribute&quot;&gt;Leader&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;       &lt;span class=&quot;attribute&quot;&gt;Replicas&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;   &lt;span class=&quot;attribute&quot;&gt;Isr&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attribute&quot;&gt;Topic&lt;/span&gt;: my-test-topic      &lt;span class=&quot;attribute&quot;&gt;Partition&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;    &lt;span class=&quot;attribute&quot;&gt;Leader&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;       &lt;span class=&quot;attribute&quot;&gt;Replicas&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;   &lt;span class=&quot;attribute&quot;&gt;Isr&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;八、通过脚本测试生产topic消息&lt;br&gt;打开window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;D&lt;/span&gt;:\&lt;span class=&quot;selector-tag&quot;&gt;home&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;kafka_2&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10-0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;bin&lt;/span&gt;&amp;gt;&lt;span class=&quot;selector-tag&quot;&gt;kafka-console-producer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.bat&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--broker-list&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:9093&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;my-test-topic&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;D&lt;/span&gt;:\&lt;span class=&quot;selector-tag&quot;&gt;home&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;kafka_2&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10-0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;在这里输入要发送的消息，然后回车&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;九、消费topic消息&lt;br&gt;打开window命令提示窗口，转到D:\home\kafka_2.10-0.10.0.1\bin目录下，执行一下命令：&lt;br&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;D&lt;/span&gt;:\&lt;span class=&quot;selector-tag&quot;&gt;home&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;kafka_2&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10-0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;bin&lt;/span&gt;&amp;gt;&lt;span class=&quot;selector-tag&quot;&gt;kafka-console-consumer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.bat&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--zookeeper&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:2181&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--from-beginning&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;my-test-topic&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;D&lt;/span&gt;:\&lt;span class=&quot;selector-tag&quot;&gt;home&lt;/span&gt;\&lt;span class=&quot;selector-tag&quot;&gt;kafka_2&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10-0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;在这里可以看到生产者发出的消息内容。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://o9tuhn58u.bkt.clouddn.com/kafka_2.10-0.10.0.1.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;修改后的文件下载地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;kafka在window下部署记录。&lt;br&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="rpc" scheme="http://blog.lehoon.cn/tags/rpc/"/>
    
      <category term="mq" scheme="http://blog.lehoon.cn/tags/mq/"/>
    
      <category term="kafka" scheme="http://blog.lehoon.cn/tags/kafka/"/>
    
      <category term="window" scheme="http://blog.lehoon.cn/tags/window/"/>
    
      <category term="scala" scheme="http://blog.lehoon.cn/tags/scala/"/>
    
  </entry>
  
  <entry>
    <title>Makefile学习</title>
    <link href="http://blog.lehoon.cn/backend/2016/08/19/makefile.html"/>
    <id>http://blog.lehoon.cn/backend/2016/08/19/makefile.html</id>
    <published>2016-08-19T03:53:43.000Z</published>
    <updated>2016-08-19T06:41:54.753Z</updated>
    
    <content type="html">&lt;p&gt;在*unix下编译工程一般使用make命令，make命令执行时，需要一个Makefile文件，告诉make怎么样去编译和链接程序。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;一、Makefile里有什么？&lt;br&gt;Makefile里主要包含了五个东西：显示规则、隐晦规则、变量定义、文件指示、注释。&lt;br&gt;1、显示规则，说明了如何生成一个或多个的目标文件。这事由makefile的书写者明显指出，要生成的文件，文件的依赖文件，生成的命令。&lt;br&gt;2、隐晦规则，由于我们的make有自动推导的功能，所以隐晦的规则可以让我们比较粗糙的简略的书写Makefile，这是由make所支持的。&lt;br&gt;3、变量的定义，在makefile中我们要定义一系列变量，变量一般都是字符串，这个有点像C语言中的宏，当Makefile被执行时，其中的变量都会被替换到响应的引用位置上。&lt;br&gt;4、文件指示，包括了三个部分，一个是在一个Makefile中引用另外一个makefile，就像C语言中的include一样；另外一个是指根据某些情况指定的Makefile中的有效部分，就像C语言中的预编译#if一样；还有就是定义一个多行的命令。&lt;br&gt;5、注释，Makefile中只有行注释，和unix的shell脚本一样，其注释是用#字符，这个就像C/C++中的“//”一样。如果你要在你的Makefile中使用”#”字符，可以用反斜杠进行转义，如：“#”。&lt;/p&gt;
&lt;p&gt;最后，在Makefile中的命令，必须要以【tab】键开始。&lt;/p&gt;
&lt;p&gt;二、Makfile的文件名&lt;br&gt;默认的情况下，make命令会在当前目录下按顺序寻找文件名为“GNUmakefile”、“makefile”、“Makefile”的文件，找到了解释这个文件。在这三个文件名中，最好使用Makefile这个文件名，因为这个文件名第一个字符为大写，这样有一种显目的感觉。最后不要用“GNUmakefile”，这个文件是GNU的make识别的。有另外一些make只对全小写的makefile文件名敏感，但是基本上来说，大多数的make都支持“makefile”和“Makefile”这两种默认文件名。&lt;/p&gt;
&lt;p&gt;当然，你也可以使用别的文件名来书写makefile，比如“Make.Linux”，“Make.Solaris”，“Make.Aix”等，如果要指定特定的Makefile，你可以使用make的-f或–file参数，如：make -f Make.Linux或make –file Make.Aix。&lt;/p&gt;
&lt;p&gt;三、引用其他的Makefile&lt;br&gt;在Makefile使用include关键字可以把别的makefile包含进来，这很像C语言的#include，被包含的文件会原模原样的放在当前文件的包含位置。&lt;br&gt;include的语法是：include &lt;filename&gt;, filename可以是当前操作系统shell的文件模式（可以包含路径和通配符）&lt;br&gt;在include前面可以有一些空字符，但是绝不能是【tab】键开始。include和&lt;filename&gt;可以用一个或多个空格隔开。举个例子，你有这样几个makefile：a.mk、b.mk、c.mk， 还有一个文件叫foo.make，以及一个变量$(bar)， 其中包含了e.mk、f.mk，那么下面的语句：&lt;br&gt;include foo.make *.mk $(bar)&lt;br&gt;等价于： include foo.make a.mk b.mk c.mk e.mk f.mk&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;
&lt;p&gt;make命令开始时，会去寻找include所指出的其他Makefile，并把其内容安置在当前的位置。就好像C/C++的include指令一样。如果文件都没有指定据对路径或相对路径的话，make会在当前目录下首先寻找，如果当前目录没有找到，那么make还会在一下的几个目录下寻找：&lt;br&gt;1、如果make执行时，有-I或者–include-dir参数，那么make就会在这个参数指定的目录下寻找。&lt;br&gt;2、如果目录&lt;perfix&gt;/include（一般是：/usr/local/bin或/usr/include）存在的话，make也会去找。&lt;/perfix&gt;&lt;/p&gt;
&lt;p&gt;如果有文件没有找到的话，make会生成一条警告信息，但不会马上出现致命错误。他会继续载入其他的文件，一旦完成makefile的读取，make会再重试这些没有找到，或是不能读取的文件，如果还是不行，make才会出现一条致命信息。如果你想让make不理那些无法读取的文件，而继续执行，你可以在include前加一个减号“-”，如：-include &lt;filename&gt;，表示无论include过程出现什么错误，都不要报错继续执行。和其他版本make兼容的相关明是sinclude。其作用和这一个是一样的。&lt;/filename&gt;&lt;/p&gt;
&lt;p&gt;四、环境变量Makefile&lt;/p&gt;
&lt;p&gt;三、Makefile的规则&lt;/p&gt;
&lt;p&gt;1、.PHONY标识后面跟着的是一个伪目标。&lt;br&gt;2、在命令前加一个小减号意思是：也许某些文件出现问题，但不用管。忽略出现的问题。&lt;br&gt;3、clean的规则要放在makefile的最后。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在*unix下编译工程一般使用make命令，make命令执行时，需要一个Makefile文件，告诉make怎么样去编译和链接程序。&lt;br&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="makefile" scheme="http://blog.lehoon.cn/tags/makefile/"/>
    
      <category term="工程编译" scheme="http://blog.lehoon.cn/tags/%E5%B7%A5%E7%A8%8B%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>HTTP缓存ETAG和Last-Modified</title>
    <link href="http://blog.lehoon.cn/frontend/2016/08/16/http-etag-last-midified.html"/>
    <id>http://blog.lehoon.cn/frontend/2016/08/16/http-etag-last-midified.html</id>
    <published>2016-08-16T03:02:54.000Z</published>
    <updated>2016-08-16T03:17:38.477Z</updated>
    
    <content type="html">&lt;p&gt;HTTP缓存ETAG和Last-Modified详解。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;基础知识&lt;br&gt;1) 什么是”Last-Modified”?&lt;br&gt;在浏览器第一次请求某一个URL时，服务器端的返回状态会是200，内容是你请求的资源，同时有一个Last-Modified的属性标记此文件在服务期端最后被修改的时间，格式类似这样：&lt;br&gt;Last-Modified: Fri, 12 May 2006 18:53:33 GMT&lt;br&gt;客户端第二次请求此URL时，根据 HTTP 协议的规定，浏览器会向服务器传送 If-Modified-Since 报头，询问该时间之后文件是否有被修改过：&lt;br&gt;If-Modified-Since: Fri, 12 May 2006 18:53:33 GMT&lt;br&gt;如果服务器端的资源没有变化，则自动返回 HTTP 304 （Not Changed.）状态码，内容为空，这样就节省了传输数据量。当服务器端代码发生改变或者重启服务器时，则重新发出资源，返回和第一次请求时类似。从而保证不向客户端重复发出资源，也保证当服务器有变化时，客户端能够得到最新的资源。&lt;br&gt;2) 什么是”Etag”?&lt;br&gt;HTTP 协议规格说明定义ETag为“被请求变量的实体值” （参见 —— 章节 14.19）。 另一种说法是，ETag是一个可以与Web资源关联的记号（token）。典型的Web资源可以一个Web页，但也可能是JSON或XML文档。服务器单独负责判断记号是什么及其含义，并在HTTP响应头中将其传送到客户端，以下是服务器端返回的格式：&lt;br&gt;ETag: “50b1c1d4f775c61:df3”&lt;br&gt;客户端的查询更新格式是这样的：&lt;br&gt;If-None-Match: W/“50b1c1d4f775c61:df3”&lt;br&gt;如果ETag没改变，则返回状态304然后不返回，这也和Last-Modified一样。本人测试Etag主要在断点下载时比较有用。&lt;br&gt;Last-Modified和Etags如何帮助提高性能?&lt;br&gt;聪明的开发者会把Last-Modified 和ETags请求的http报头一起使用，这样可利用客户端（例如浏览器）的缓存。因为服务器首先产生 Last-Modified/Etag标记，服务器可在稍后使用它来判断页面是否已经被修改。本质上，客户端通过将该记号传回服务器要求服务器验证其（客户端）缓存。&lt;br&gt;过程如下: &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;1. 客户端请求一个页面（A）。  
2. 服务器返回页面A，并在给A加上一个Last-Modified/ETag。  
3. 客户端展现该页面，并将页面连同Last-Modified/ETag一起缓存。  
4. 客户再次请求页面A，并将上次请求时服务器返回的Last-Modified/ETag一起传递给服务器。  
5. 服务器检查该Last-Modified或ETag，并判断出该页面自上次客户端请求之后还未被修改，直接返回响应304和一个空的响应体。
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;HttpClient Redirects Handling&lt;br&gt;简介&lt;br&gt;这份文档简单介绍下 HttpClient 手动处理重定向功能。&lt;br&gt;因为某些原因，比如需要人工的支持或者 HttpClient 不支持又或者网络的限制（如需要特殊的权限才可以访问的资源），有些类型的重定向是 HttpClient 不能自动处理的。当前版本的 HttpClient 不能够自动处理 POST 和 PUT 方法的重定向。&lt;br&gt;手动处理重定向&lt;br&gt;介于 300 和 399 之间的状态码，都代表重定向。最常见的重定向状态码如下：&lt;br&gt;· 301 HttpStatus.SC_MOVED_PERMANENTLY ，永久移除。&lt;br&gt;· 302 HtpStatus.SC_MOVED_TEMPORARILY ，暂时移除。&lt;br&gt;· 303 HttpStatus.SC_SEE_OTHER ，重定向到其他资源。&lt;br&gt;· 307 HttpStatus.SC_TEMPORARY_REDIRECT ，临时重定向。&lt;br&gt;注意：有些 3XX 的状态码并不只是简单给发送请求标识一个不同的 URL 。这些状态码需要应用自行处理。&lt;br&gt;当应用程序收个一个简单的重定向 Responses 时，必须用新的 URL 去执行 HttpMethod 的 executeMethod 方法，重新下载新 URL 对应的资源。通常，我们采用递归的方式去处理重定向，以防有多个重定向，不过要加标识数去结束你的递归。&lt;br&gt;&lt;figure class=&quot;highlight oxygene&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;String redirectLocation;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Header locationHeader = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;getResponseHeader&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&quot;location&quot;)&lt;/span&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (locationHeader != null) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    redirectLocation = locationHeader.getValue();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // The response is invalid and did not provide the new location for&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // the resource. Report an error or possibly handle the response&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // like a 404 Not Found error.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;String redirectLocation;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Header locationHeader = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;getResponseHeader&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&quot;location&quot;)&lt;/span&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (locationHeader != null) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    redirectLocation = locationHeader.getValue();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // The response is invalid and did not provide the new location for&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // the resource. Report an error or possibly handle the response&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // like a 404 Not Found error.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;当得到新的 Location 以后，你可以对待一个新的 URL 一样，使用 HttpClient 去请求对应的资源。&lt;br&gt;开发过web应用的人，应该都知道http重定向这个功能，html就有最简单的方法：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;http-equiv&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;refresh&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;5;url=http://blog.lehoon.cn&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;，&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;也就是告诉你的浏览器5秒之后自动跳转到我的c++博客首页&lt;a href=&quot;http://blog.lehoon.cn&quot;&gt;http://blog.lehoon.cn&lt;/a&gt; 。 重定向常常用于自动跳转，从活动空间来看大概分两类：服务器内部跳转和服务器之间跳转。&lt;br&gt;服务器内部跳转常见于“登陆成功！5秒之后将自动进入首页”这种应用。而服务器之间跳转，种类稍微&lt;br&gt;多一些：(1)从服务器内跳往外部服务器; (2)从A服务器跳转到B服务器，接着跳转到C服务器;&lt;br&gt;(3) 从A服务器跳转到B服务器, 业务处理完毕之后又跳转到A服务器; (4) 从用户浏览器向A服务器&lt;br&gt;发送请求，在出口网关处进行重定向，如通过iptable之类，重定向到一个认证服务器B，返回一个&lt;br&gt;认证登陆的页面，当用户输入了正确的用户名和密码等，认证服务器B再通过http重定向到A服务器. 以上所说的4种模式，前3种不值一提，而第4种则有些问题，不是那么容易跳转成功的。&lt;br&gt;不管你的认证服务器B是用现在的tomcat还是resin，或者其它流行的web服务器，最后发现总是&lt;br&gt;不能从认证服务器B跳到A服务器. 刚开始怀疑html那种方法不行，就改用javascript写法，改用jsp调用&lt;br&gt;方法，甚至直接在servlet里调用重定向接口，一一试遍，都失败了，这才怀疑可能不是程序写法上&lt;br&gt;的问题。 在万般无奈情况下，使用CommView工具来抓包看看，从tcp包本身、http request和http response&lt;br&gt;包内容来看，看不出什么不对。但发现整个跳转只在一个tcp连接上进行，这使我想到iptable把向A服务器&lt;br&gt;的请求偷偷转发到认证服务器B, 而浏览器还认为认证服务器B就是A服务器, 所以只要这条tcp连接不断，&lt;br&gt;浏览器就一直认为这种映射关系正确，所以你怎么也跳转不到真正的目的地-A服务器. 但是我们用老版本httpd或thttpd做web服务器，则可以正常跳转，何故？http协议版本差别：&lt;br&gt;老版本httpd或thttpd采用http1.0协议，而tomcat和resin这些jsp容器最新版本，大都已经实现了http1.1&lt;br&gt;协议了，对我们这个问题就是connection是采用非持久的还是持久模式，提取两个版本协议说明:&lt;br&gt;(1) http1.0:&lt;br&gt;原文：Except for experimental applications, current practice requires that the connection be established by the client prior to each request and closed by the server after sending the response.&lt;br&gt;翻译：实验室应用除外，当前的做法是客户端在每次请求之前建立连接，而服务器端在发送回应后关闭此连接。&lt;br&gt;(2) http1.1:原文：In HTTP/1.0, most implementations used a new connection for each request/response exchange.&lt;br&gt;In HTTP/1.1, a connection may be used for one or more request/response exchanges,&lt;br&gt;although connections may be closed for a variety of reasons (see section 8.1).&lt;br&gt;翻译：在HTTP/1.0协议下，大多数HTTP服务器实现对每一个请求/应答使用一个新连接. 而在HTTP/1.1协议下，一个或多个请求/应答使用同一个连接。&lt;br&gt;(section 8.1详细说明了为什么这么做) 从协议上分析清楚之后，我们怎么解决上面那个现实问题？肯定不能使用http1.1这种持久性连接。&lt;br&gt;查了下tomcat docment说明，默认实现了http1.1，现在版本的connector已经早不提供http1.0支持了，&lt;br&gt;难道我们要退回到http1.0的版本？那是多么痛苦的事情。再查查tomcat/conf/server.xml里关于connector&lt;br&gt;的配置,有一个参数connecttimeout,默认是20000ms, 作为服务器不可能争对socket accept()的，应该是&lt;br&gt;socket recv()的超时，那么我们设置它为比我们&lt;code&gt;&amp;lt;meta http-equiv=&amp;quot;refresh&amp;quot; content=&amp;quot;5;url=http://blog.lehoon.cn&amp;quot;&amp;gt;&lt;/code&gt;里&lt;br&gt;秒数小就可以了，保证在跳转之前以前的tcp连接被tomcat服务器断开就可以了，当然iptable应该在认证成功&lt;br&gt;之后不再对这个上网用户发出的http请求重定向到认证服务器, 这个很容易做到，暂不提细节。&lt;br&gt;最后附上UML图以方便理解：&lt;br&gt;&lt;img src=&quot;http://o9tuhn58u.bkt.clouddn.com/http-etag-modified.jpg&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;HTTP缓存ETAG和Last-Modified详解。&lt;br&gt;
    
    </summary>
    
      <category term="前端" scheme="http://blog.lehoon.cn/categories/frontend/"/>
    
    
      <category term="http" scheme="http://blog.lehoon.cn/tags/http/"/>
    
      <category term="etag" scheme="http://blog.lehoon.cn/tags/etag/"/>
    
      <category term="last-midified" scheme="http://blog.lehoon.cn/tags/last-midified/"/>
    
  </entry>
  
  <entry>
    <title>ip地址分类</title>
    <link href="http://blog.lehoon.cn/orther/2016/08/16/ip-catagory.html"/>
    <id>http://blog.lehoon.cn/orther/2016/08/16/ip-catagory.html</id>
    <published>2016-08-16T01:23:25.000Z</published>
    <updated>2016-08-16T01:32:24.318Z</updated>
    
    <content type="html">&lt;p&gt;现在的IP网络使用32位地址，以点分十进制表示，如172.16.0.0。地址格式为：IP地址=网络地址＋主机地址 或 IP地址=主机地址＋子网地址＋主机地址。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;按照IP地址的逻辑层次来分，IP地址可以分为A，B，C，D，E等5类。A类IP地址用于大型网络，B类IP地址用于中型网络，C类用于小规模网络，最多只能连接256台设备，D类IP地址用于多目的地址发送，E类则保留为今后使用。&lt;br&gt;1．A类IP地址&lt;br&gt;一个A类IP地址由1字节（每个字节是8位）的网络地址和3个字节主机地址组成，网络地址的最高位必须是“0”,即第一段数字范围为1～127。每个A类地址可连接2的24次方减2等于16777214台主机，Internet有2的7次方减2等于126个A类地址。&lt;br&gt;2．B类IP地址&lt;br&gt;一个B类IP地址由2个字节的网络地址和2个字节的主机地址组成，网络地址的最高位必须是“10”，即第一段数字范围为128～191。每个B类地址可连接2的16次方减2等于65534台主机，Internet有2的14次方减2等于16382个B类地址。&lt;br&gt;3．C类IP地址&lt;br&gt;一个C类地址是由3个字节的网络地址和1个字节的主机地址组成，网络地址的最高位必须是“ll0”，即第一段数字范围为192～223。每个C类地址可连接2的8次方减2等于254台主机，Internet有2的21次方减2等于2097150个C类地址。&lt;br&gt;4．D类地址&lt;br&gt;第一个字节以“lll0”开始，第一个字节的数字范围为224～239，是多点播送地址，用于多目的地信息的传输，和作为备用。全零（“0．0．0．0”）地址对应于当前主机，全“1”的IP地址（“255．255．255．255”）是当前子网的广播地址。用于多点播送。&lt;br&gt;5．E类地址&lt;br&gt;以“llll0”开始，即第一段数字范围为240～254。E类地址保留，仅作实验和开发用。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;现在的IP网络使用32位地址，以点分十进制表示，如172.16.0.0。地址格式为：IP地址=网络地址＋主机地址 或 IP地址=主机地址＋子网地址＋主机地址。&lt;br&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="ip" scheme="http://blog.lehoon.cn/tags/ip/"/>
    
      <category term="ipv4" scheme="http://blog.lehoon.cn/tags/ipv4/"/>
    
  </entry>
  
  <entry>
    <title>android非浏览器应用程序与服务器会话保持实现</title>
    <link href="http://blog.lehoon.cn/orther/2016/08/09/android-connection-session.html"/>
    <id>http://blog.lehoon.cn/orther/2016/08/09/android-connection-session.html</id>
    <published>2016-08-09T03:37:41.000Z</published>
    <updated>2016-08-09T03:40:16.040Z</updated>
    
    <content type="html">&lt;p&gt;因为android手机端在访问web服务器时，没有给http请求头部设置sessionID，而使用web浏览器作为客户端访问服务器时，在客户端每次发起请求的时候，都会将交互中的sessionID：SESSIONID设置在Cookie头中携带过去，服务器根据这个sessionID获取对应的Session,而不是重新创建一个新Session(除了这个Session失效)。所以实现方式就是在http通信的时候，在header头上设置sessionid。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;因为android手机端在访问web服务器时，没有给http请求头部设置sessionID，而使用web浏览器作为客户端访问服务器时，在客户端每次发起请求的时候，都会将交互中的sessionID：SESSIONID设置在Cookie头中携带过去，服务器根据这个sessionID获取对应的Session,而不是重新创建一个新Session(除了这个Session失效)。所以实现方式就是在http通信的时候，在header头上设置sessionid。&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="android" scheme="http://blog.lehoon.cn/tags/android/"/>
    
      <category term="java" scheme="http://blog.lehoon.cn/tags/java/"/>
    
      <category term="安卓" scheme="http://blog.lehoon.cn/tags/%E5%AE%89%E5%8D%93/"/>
    
  </entry>
  
  <entry>
    <title>memcache与memcached区别</title>
    <link href="http://blog.lehoon.cn/backend/2016/07/28/memcache-memcached-diff.html"/>
    <id>http://blog.lehoon.cn/backend/2016/07/28/memcache-memcached-diff.html</id>
    <published>2016-07-28T00:50:14.000Z</published>
    <updated>2016-07-28T00:52:23.724Z</updated>
    
    <content type="html">&lt;p&gt;Memcache是一个自由和开放源代码、高性能、分配的内存对象缓存系统。用于加速动态web应用程序，减轻数据库负载。它可以应对任意多个连接，使用非阻塞的网络IO。由于它的工作机制是在内存中开辟一块空间，然后建立一个Hash表，Memcached自管理这些Hash表。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;Memcache是什么？&lt;br&gt;Memcache是一个自由和开放源代码、高性能、分配的内存对象缓存系统。用于加速动态web应用程序，减轻数据库负载。它可以应对任意多个连接，使用非阻塞的网络IO。由于它的工作机制是在内存中开辟一块空间，然后建立一个Hash表，Memcached自管理这些Hash表。&lt;br&gt;Memcached是简单而强大的。它简单的设计促进迅速部署，易于发展所面临的问题，解决了很多大型数据缓存。它的API可供最流行的语言。&lt;br&gt;Memcache官方网站：&lt;a href=&quot;http://memcached.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://memcached.org/&lt;/a&gt;&lt;br&gt;Memcached又是什么？&lt;br&gt;Memcache是该系统的项目名称，Memcached是该系统的主程序文件（字母d可以理解为daemon），以守护程序方式运行于一个或多个服务器中，随时接受客户端的连接操作，使用共享内存存取数据。&lt;br&gt;memcache客户端(php)&lt;br&gt;PHP有两个memcache客户端：php memcache和php memcached。&lt;br&gt;php memcache独立用php实现，是老客户端，从我们实践中已发现有多个问题，而且功能少，属性也可设置的少；&lt;br&gt;&lt;a href=&quot;http://pecl.php.net/package/memcache&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://pecl.php.net/package/memcache&lt;/a&gt;&lt;br&gt;php memcached是基于原生的c的libmemcached的扩展，更加完善，建议替换为php memcached。&lt;br&gt;&lt;a href=&quot;http://pecl.php.net/package/memcached&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://pecl.php.net/package/memcached&lt;/a&gt;&lt;br&gt;memcached安装(服务端)&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /root/lnmp/src/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget http://memcached.googlecode.com/files/memcached-1.4.15.tar.gz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tar xzf memcached-1.4.15.tar.gz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; memcached-1.4.15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./configure --prefix=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;make &amp;amp;&amp;amp; make install&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ln &lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt; /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/memcached/bin/memcached /usr/bin/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/bin/cp scripts/memcached.sysv /etc/init.d/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;s@^USER=.*@USER=root@&#39;&lt;/span&gt; /etc/init.d/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;s@chown@#chown@&#39;&lt;/span&gt; /etc/init.d/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;s@/var/run/memcached/memcached.pid@/var/run/memcached.pid@&#39;&lt;/span&gt; /etc/init.d/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;s@^prog=.*@prog=&quot;/usr/local/memcached/bin/memcached&quot;@&#39;&lt;/span&gt; /etc/init.d/memcached &lt;span class=&quot;comment&quot;&gt;#前面有软链接，这里可以省略&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chmod +x /etc/init.d/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chkconfig --add memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chkconfig memcached on&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ..&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;启动memcached:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service memcached start  &lt;span class=&quot;comment&quot;&gt;#或者执行下面&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;memcached -p 11211 &lt;span class=&quot;_&quot;&gt;-l&lt;/span&gt; 127.0.0.1 &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; -u root -P /var/run/memcached.pid -m 64M -c 1024&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;几个参数的解释：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-p memcached监听的TCP端口&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;_&quot;&gt;-l&lt;/span&gt; 监听的ip地址，127.0.0.1是本机，当然也可以写上你的服务器IP，如：10.0.0.10，这是我服务器的IP地址，如果你需要多个服务器都能够读取这台memcached的缓存数据，那么就必须设定这个ip&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; 以daemon方式运行，将程序放入后台&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-u memcached的运行用户，我设定的是nobody&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-P memcached的pid文件路径&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-m memcached可以使用的最大内存数量&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-c memcached同时可以接受的最大的连接数&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;如果你希望以socket方式来访问memcached，那么在启动的时候就必须去掉 &lt;span class=&quot;_&quot;&gt;-l&lt;/span&gt;和-p参数，并加上&lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt;参数：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt; memcached的socket文件路径&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;php中memcache扩展组件的安装：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tar xzf memcache-2.2.7.tgz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; memcache-2.2.7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/php/bin/phpize&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./configure --with-php-config=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/php/bin/php-config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;make &amp;amp;&amp;amp; make install&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ../&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;按照我的环境，编译出来的memcache.so自动生成在/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/php/lib/php/extensions/no-debug-non-zts-20121212/ 目录下，如果你的环境不一样，你得根据自己情况修改你的php.ini了。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;接着要做的工作就是让php加载这个扩展，编辑你的php.ini，在适当位置（通常是最后，也可以是独立的一个ini文件）加入如下行：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;extension=memcache.so&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;然后重启php或者apache，运行一个phpinfo()来确认一下，正常的话你应该可以看到这个了：memcache&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;php-memcache的简单使用举例：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;?php&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt; = new Memcache;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt;-&amp;gt;connect(&lt;span class=&quot;string&quot;&gt;&#39;127.0.0.1&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;11211&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt;-&amp;gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt;CompressThreshold(20000, 0.2);    // 设置压缩   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt;-&amp;gt;getVersion();                   // 输出memcached版本   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$test&lt;/span&gt; = array(1,2,3,4,5,&lt;span class=&quot;string&quot;&gt;&#39;abcde&#39;&lt;/span&gt;);               //生成一个数组   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt;-&amp;gt;get(&lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;))&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;_r(&lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt;-&amp;gt;get(&lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;));        //获取数据   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;cached&#39;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;variable&quot;&gt;$memcache&lt;/span&gt;-&amp;gt;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$test&lt;/span&gt;,0,30);      //写入数据   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;no cache&#39;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;?&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;php中memcached扩展组件的安装（LNMP一键安装包）：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;最新版ibmemcached-1.0.17.tar.gz可能会报错error: ‘HAVE_MEMCACHED_BINARY’ was not declared &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; this scope&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;用libmemcached-1.0.16.tar.gz没问题&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;安装如下：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget https://launchpad.net/libmemcached/1.0/1.0.16/+download/libmemcached-1.0.16.tar.gz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget http://pecl.php.net/get/memcached-2.1.0.tgz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tar xzf libmemcached-1.0.16.tar.gz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; libmemcached-1.0.16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./configure --with-memcached=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/memcached&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;make &amp;amp;&amp;amp; make install&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ..&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tar xzf memcached-2.1.0.tgz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; memcached-2.1.0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/php/bin/phpize&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./configure --with-php-config=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/php/bin/php-config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;make &amp;amp;&amp;amp; make install&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;按照我的环境，编译出来的memcached.so自动生成在 /usr/local/php/lib/php/extensions/no-debug-non-zts-20121212/ 目录下，如果你的环境不一样，你得根据自己情况修改你的php.ini了。&lt;br&gt;接着要做的工作就是让php加载这个扩展，编辑你的php.ini，在适当位置（通常是最后，也可以是独立的一个ini文件）加入如下行：&lt;br&gt;extension=memcached.so&lt;br&gt;然后重启php或者apache，运行一个phpinfo()来确认一下，正常的话你应该可以看到这个了：memcached&lt;br&gt;总结：&lt;br&gt;其实很简单，memcache是php的一个扩展，用于php管理memcached(服务端)，php-memcache.dll。&lt;br&gt;如果安装了memcached(服务端)不安装扩展，那么php无法操控memcached，但是命令行使用起来没有问题&lt;br&gt;如果安装了PHP memcache客户端(php memcache和php memcached)。但是没有安装memcached(服务端)服务，那么这个就无法使用&lt;br&gt;只有同时安装了memcached(服务端)和PHP memcache客户端扩展才可以提高动态网站性能&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Memcache是一个自由和开放源代码、高性能、分配的内存对象缓存系统。用于加速动态web应用程序，减轻数据库负载。它可以应对任意多个连接，使用非阻塞的网络IO。由于它的工作机制是在内存中开辟一块空间，然后建立一个Hash表，Memcached自管理这些Hash表。&lt;br&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="c" scheme="http://blog.lehoon.cn/tags/c/"/>
    
      <category term="memcache" scheme="http://blog.lehoon.cn/tags/memcache/"/>
    
  </entry>
  
  <entry>
    <title>centos-lvs</title>
    <link href="http://blog.lehoon.cn/%E7%BC%96%E7%A8%8B/2016/07/19/centos-lvs.html"/>
    <id>http://blog.lehoon.cn/编程/2016/07/19/centos-lvs.html</id>
    <published>2016-07-19T06:57:50.000Z</published>
    <updated>2016-07-19T06:57:51.057Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>awk学习</title>
    <link href="http://blog.lehoon.cn/orther/2016/07/19/awk.html"/>
    <id>http://blog.lehoon.cn/orther/2016/07/19/awk.html</id>
    <published>2016-07-19T06:42:56.000Z</published>
    <updated>2016-07-19T06:50:19.659Z</updated>
    
    <content type="html">&lt;p&gt;awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;一.AWK 说明&lt;br&gt;awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。&lt;br&gt;awk的处理文本和数据的方式：它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出(屏幕)，如果没有指定模式，则所有被操作所指定的行都被处理。&lt;br&gt;awk分别代表其作者姓氏的第一个字母。因为它的作者是三个人，分别是Alfred Aho、Brian Kernighan、Peter Weinberger。&lt;br&gt;gawk是awk的GNU版本，它提供了Bell实验室和GNU的一些扩展。下面介绍的awk是以GUN的gawk为例的，在linux系统中已把awk链接到gawk，所以下面全部以awk进行介绍。&lt;/p&gt;
&lt;p&gt;二.awk命令格式和选项&lt;br&gt;2.1. awk的语法有两种形式&lt;br&gt;awk [options] ‘script’ var=value file(s)&lt;br&gt;awk [options] -f scriptfile var=value file(s)&lt;/p&gt;
&lt;p&gt;2.2. 命令选项&lt;br&gt;（1）-F fs or –field-separator fs ：指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式，如-F:。&lt;br&gt;（2）-v var=value or –asign var=value ：赋值一个用户定义变量。&lt;br&gt;（3）-f scripfile or –file scriptfile ：从脚本文件中读取awk命令。&lt;br&gt;（4）-mf nnn and -mr nnn ：对nnn值设置内在限制，-mf选项限制分配给nnn的最大块数目；-mr选项限制记录的最大数目。这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用。&lt;br&gt;（5）-W compact or –compat, -W traditional or –traditional ：在兼容模式下运行awk。所以gawk的行为和标准的awk完全一样，所有的awk扩展都被忽略。&lt;br&gt;（6）-W copyleft or –copyleft, -W copyright or –copyright ：打印简短的版权信息。&lt;br&gt;（7）-W help or –help, -W usage or –usage ：打印全部awk选项和每个选项的简短说明。&lt;br&gt;（8）-W lint or –lint ：打印不能向传统unix平台移植的结构的警告。&lt;br&gt;（9）-W lint-old or –lint-old ：打印关于不能向传统unix平台移植的结构的警告。&lt;br&gt;（10）-W posix ：打开兼容模式。但有以下限制，不识别：/x、函数关键字、func、换码序列以及当fs是一个空格时，将新行作为一个域分隔符；操作符&lt;strong&gt;和&lt;/strong&gt;=不能代替^和^=；fflush无效。&lt;br&gt;（11）-W re-interval or –re-inerval ：允许间隔正则表达式的使用，参考(grep中的Posix字符类)，如括号表达式[[:alpha:]]。&lt;br&gt;（12）-W source program-text or –source program-text ：使用program-text作为源代码，可与-f命令混用。&lt;br&gt;（13）-W version or –version ：打印bug报告信息的版本。&lt;/p&gt;
&lt;p&gt;三. 模式和操作&lt;br&gt;awk脚本是由模式和操作组成的：&lt;br&gt;              pattern {action} 如$ awk ‘/root/‘ test，或$ awk ‘$3 &amp;lt; 100’ test。&lt;br&gt;       两者是可选的，如果没有模式，则action应用到全部记录，如果没有action，则输出匹配全部记录。默认情况下，每一个输入行都是一条记录，但用户可通过RS变量指定不同的分隔符进行分隔。&lt;/p&gt;
&lt;p&gt;3.1.模式&lt;br&gt;模式可以是以下任意一个：&lt;br&gt;（1）正则表达式：使用通配符的扩展集。&lt;br&gt;（2）关系表达式：可以用下面运算符表中的关系运算符进行操作，可以是字符（3）串或数字的比较，如$2&amp;gt;%1选择第二个字段比第一个字段长的行。&lt;br&gt;（4）模式匹配表达式：用运算符~(匹配)和~!(不匹配)。&lt;br&gt;（5）模式，模式：指定一个行的范围。该语法不能包括BEGIN和END模式。&lt;br&gt;（6）BEGIN：让用户指定在第一条输入记录被处理之前所发生的动作，通常可在这里设置全局变量。&lt;br&gt;（7）END：让用户在最后一条输入记录被读取之后发生的动作。&lt;/p&gt;
&lt;p&gt;3.2.操作&lt;br&gt;  操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内。主要有四部份：&lt;br&gt;（1）变量或数组赋值&lt;br&gt;（2）输出命令&lt;br&gt;（3）内置函数&lt;br&gt;（4）控制流命令&lt;/p&gt;
&lt;p&gt;四.awk的环境变量&lt;br&gt;变量&lt;br&gt;描述&lt;br&gt;$n&lt;br&gt;当前记录的第n个字段，字段间由FS分隔。&lt;br&gt;$0&lt;br&gt;完整的输入记录。&lt;br&gt;ARGC&lt;br&gt;命令行参数的数目。&lt;br&gt;ARGIND&lt;br&gt;命令行中当前文件的位置(从0开始算)。&lt;br&gt;ARGV&lt;br&gt;包含命令行参数的数组。&lt;br&gt;CONVFMT&lt;br&gt;数字转换格式(默认值为%.6g)&lt;br&gt;ENVIRON&lt;br&gt;环境变量关联数组。&lt;br&gt;ERRNO&lt;br&gt;最后一个系统错误的描述。&lt;br&gt;FIELDWIDTHS&lt;br&gt;字段宽度列表(用空格键分隔)。&lt;br&gt;FILENAME&lt;br&gt;当前文件名。&lt;br&gt;FNR&lt;br&gt;同NR，但相对于当前文件。&lt;br&gt;FS&lt;br&gt;字段分隔符(默认是任何空格)。&lt;br&gt;IGNORECASE&lt;br&gt;如果为真，则进行忽略大小写的匹配。&lt;br&gt;NF&lt;br&gt;当前记录中的字段数。&lt;br&gt;NR&lt;br&gt;当前记录数。&lt;br&gt;OFMT&lt;br&gt;数字的输出格式(默认值是%.6g)。&lt;br&gt;OFS&lt;br&gt;输出字段分隔符(默认值是一个空格)。&lt;br&gt;ORS&lt;br&gt;输出记录分隔符(默认值是一个换行符)。&lt;br&gt;RLENGTH&lt;br&gt;由match函数所匹配的字符串的长度。&lt;br&gt;RS&lt;br&gt;记录分隔符(默认是一个换行符)。&lt;br&gt;RSTART&lt;br&gt;由match函数所匹配的字符串的第一个位置。&lt;br&gt;SUBSEP&lt;br&gt;数组下标分隔符(默认值是/034)。&lt;/p&gt;
&lt;p&gt;五. awk运算符&lt;br&gt;&lt;figure class=&quot;highlight asciidoc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;运算符&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;描述&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;= += -= *= /= %= ^= **=&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;赋值&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;?:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;C条件表达式&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;||&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;逻辑或&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;amp;&amp;amp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;逻辑与&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;~ ~!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;匹配正则表达式和不匹配正则表达式&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt; &amp;lt;= &amp;gt; &amp;gt;= != ==&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;关系运算符&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;空格&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;连接&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ -&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;加，减&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;* &lt;/span&gt;/ &amp;amp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;乘，除与求余&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ - !&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;一元加，减和逻辑非&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;^ ***&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;求幂&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;++ --&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;增加或减少，作为前缀或后缀&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;字段引用&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;in&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;数组成员&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;六.记录和域&lt;br&gt;6.1. 记录&lt;br&gt;       awk把每一个以换行符结束的行称为一个记录。&lt;br&gt;       记录分隔符：默认的输入和输出的分隔符都是回车，保存在内建变量ORS和RS中。&lt;br&gt;       $0变量：它指的是整条记录。如$ awk ‘{print $0}’ test将输出test文件中的所有记录。&lt;br&gt;       变量NR：一个计数器，每处理完一条记录，NR的值就增加1。&lt;br&gt;       如$ awk ‘{print NR,$0}’ test将输出test文件中所有记录，并在记录前显示记录号。&lt;/p&gt;
&lt;p&gt;6.2. 域&lt;br&gt;       记录中每个单词称做“域”，默认情况下以空格或tab分隔。awk可跟踪域的个数，并在内建变量NF中保存该值。如$ awk ‘{print $1,$3}’ test将打印test文件中第一和第三个以空格分开的列(域)。&lt;/p&gt;
&lt;p&gt;6.3. 域分隔符&lt;br&gt;       内建变量FS保存输入域分隔符的值，默认是空格或tab。我们可以通过-F命令行选项修改FS的值。如$ awk -F: ‘{print $1,$5}’ test将打印以冒号为分隔符的第一，第五列的内容。&lt;br&gt;       可以同时使用多个域分隔符，这时应该把分隔符写成放到方括号中，如$awk -F’[:/t]’ ‘{print $1,$3}’ test，表示以空格、冒号和tab作为分隔符。&lt;br&gt;       输出域的分隔符默认是一个空格，保存在OFS中。如$ awk -F: ‘{print $1,$5}’ test，$1和$5间的逗号就是OFS的值。&lt;/p&gt;
&lt;p&gt;七.gawk专用正则表达式元字符&lt;/p&gt;
&lt;p&gt;以下几个是gawk专用的，不适合unix版本的awk。&lt;br&gt;（1）/Y ：匹配一个单词开头或者末尾的空字符串。&lt;br&gt;（2）/B：匹配单词内的空字符串。&lt;br&gt;（3）/&amp;lt;：匹配一个单词的开头的空字符串，锚定开始。&lt;br&gt;（4）/&amp;gt; ：匹配一个单词的末尾的空字符串，锚定末尾。&lt;br&gt;（5）/w ：匹配一个字母数字组成的单词。&lt;br&gt;（6）/W ：匹配一个非字母数字组成的单词。&lt;br&gt;（7）/‘：匹配字符串开头的一个空字符串。&lt;br&gt;（8）/‘ ：匹配字符串末尾的一个空字符串。&lt;/p&gt;
&lt;p&gt;八. 匹配操作符(~)&lt;br&gt;       用来在记录或者域内匹配正则表达式。如$ awk ‘$1 ~/^root/‘ test将显示test文件第一列中以root开头的行。&lt;/p&gt;
&lt;p&gt;九. 比较表达式&lt;br&gt;conditional expression1 ? expression2: expression3，&lt;br&gt;例如：$ awk ‘{max = {$1 &amp;gt; $3} ? $1: $3: print max}’ test。如果第一个域大于第三个域，$1就赋值给max，否则$3就赋值给max。&lt;br&gt;$ awk ‘$1 + $2 &amp;lt; 100’ test。如果第一和第二个域相加大于100，则打印这些行。&lt;br&gt;$ awk ‘$1 &amp;gt; 5 &amp;amp;&amp;amp; $2 &amp;lt; 10’ test,如果第一个域大于5，并且第二个域小于10，则打印这些行。&lt;/p&gt;
&lt;p&gt;十. 范围模板&lt;br&gt;       范围模板匹配从第一个模板的第一次出现到第二个模板的第一次出现之间所有行。如果有一个模板没出现，则匹配到开头或末尾。如$ awk ‘/root/,/mysql/‘ test将显示root第一次出现到mysql第一次出现之间的所有行。&lt;/p&gt;
&lt;p&gt;十一.示例&lt;br&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;119&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;120&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;121&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;122&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;123&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;124&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;125&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;126&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;127&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;128&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;129&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;130&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;131&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;132&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;133&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;134&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;135&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;136&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;137&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1、awk &#39;/101/&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 显示文件&lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;中包含101的匹配行。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;/101/,/105/&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; == 5&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; == &lt;span class=&quot;string&quot;&gt;&quot;CT&quot;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 注意必须带双引号 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; * &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt; &amp;gt;100 &#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt; &amp;gt;5 &amp;amp;&amp;amp; &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt;&amp;lt;=15&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2、awk &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; NR,NF,&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$NF&lt;/span&gt;,&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 显示文件&lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;的当前记录号、域数和每一行的第一个和最后一个域。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;/101/ &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt; + 10&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 显示文件&lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;的匹配行的第一、二个域加10。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;/101/ &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$2&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;/101/ &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$2&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 显示文件&lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;的匹配行的第一、二个域，但显示时域中间没有分隔符。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3、df | awk &#39;&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;gt;1000000 &#39; 通过管道符获得输入，如：显示第4个域满足条件的行。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4、awk -F &lt;span class=&quot;string&quot;&gt;&quot;|&quot;&lt;/span&gt; &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 按照新的分隔符“|”进行操作。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;BEGIN &amp;#123; FS=&lt;span class=&quot;string&quot;&gt;&quot;[: /t|]&quot;&lt;/span&gt; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$3&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 通过设置输入分隔符（FS=&lt;span class=&quot;string&quot;&gt;&quot;[: /t|]&quot;&lt;/span&gt;）修改输入分隔符。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sep=&lt;span class=&quot;string&quot;&gt;&quot;|&quot;&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk -F &lt;span class=&quot;variable&quot;&gt;$Sep&lt;/span&gt; &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 按照环境变量Sep的值做为分隔符。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk -F &#39;[ :/t|]&#39; &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 按照正则表达式的值做为分隔符，这里代表空格、:、&lt;span class=&quot;keyword&quot;&gt;TAB&lt;/span&gt;、|同时做为分隔符。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk -F &#39;[][]&#39; &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 按照正则表达式的值做为分隔符，这里代表[、] &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5、awk -f awkfile &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 通过文件awkfile的内容依次进行控制。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;cat&lt;/span&gt; awkfile &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/101/&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/047 Hello! /047&quot;&lt;/span&gt;&amp;#125; --遇到匹配行以后打印 &#39; Hello! &#39;./047代表单引号。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$2&amp;#125;&lt;/span&gt; --因为没有模式控制，打印每一行的前两个域。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6、awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; ~ /101/ &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 显示文件中第一个域匹配101的行（记录）。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7、awk &#39;BEGIN &amp;#123; OFS=&lt;span class=&quot;string&quot;&gt;&quot;%&quot;&lt;/span&gt;&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$2&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 通过设置输出分隔符（OFS=&lt;span class=&quot;string&quot;&gt;&quot;%&quot;&lt;/span&gt;）修改输出格式。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8、awk &#39;BEGIN &amp;#123; max=100 ;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;max=&quot;&lt;/span&gt; max&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       BEGIN 表示在处理任意行之前进行的操作。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;max=(&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; &amp;gt;max ?&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;:max); &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;Now max is &quot;&lt;/span&gt;max&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 取得文件第一个域的最大值。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9、awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; * &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt; &amp;gt;100 &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 显示文件中第一个域匹配101的行（记录）。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10、awk &#39;&amp;#123;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; == &#39;Chi&#39; &amp;#123;&lt;span class=&quot;variable&quot;&gt;$3&lt;/span&gt; = &#39;China&#39;; &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt;&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 找到匹配行后先将第3个域替换后再显示该行（记录）。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&amp;#123;&lt;span class=&quot;variable&quot;&gt;$7&lt;/span&gt; %= 3; &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$7&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 将第7域被3除，并将余数赋给第7域再打印。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11、awk &#39;/tom/ &amp;#123;wage=&lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt;+&lt;span class=&quot;variable&quot;&gt;$3&lt;/span&gt;; printf wage&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 找到匹配行后为变量wage赋值并打印该变量。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12、awk &#39;/tom/ &amp;#123;&lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt;++;&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;END &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;tom was found &quot;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot; times&quot;&lt;/span&gt;&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;END表示在所有输入行处理完后进行处理。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13、awk &#39;gsub(&lt;span class=&quot;comment&quot;&gt;//$/,&quot;&quot;);gsub(/,/,&quot;&quot;); cost+=$4; &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;END &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;The total is $&quot;&lt;/span&gt; cost&amp;gt;&lt;span class=&quot;string&quot;&gt;&quot;filename&quot;&lt;/span&gt;&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gsub函数用空串替换$和,再将结果输出到filename中。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1 2 3 &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;,200.00 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1 2 3 &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt;,300.00 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1 2 3 &lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;,000.00 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&amp;#123;gsub(&lt;span class=&quot;comment&quot;&gt;//$/,&quot;&quot;);gsub(/,/,&quot;&quot;); &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;gt;1000&amp;amp;&amp;amp;&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;lt;2000) c1+=&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;gt;2000&amp;amp;&amp;amp;&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;lt;3000) c2+=&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;gt;3000&amp;amp;&amp;amp;&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;lt;4000) c3+=&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; c4+=&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;END &amp;#123;printf &lt;span class=&quot;string&quot;&gt;&quot;c1=[%d];c2=[%d];c3=[%d];c4=[%d]/n&quot;&lt;/span&gt;,c1,c2,c3,c4&amp;#125;&quot;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;通过&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;和&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;完成条件语句 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&amp;#123;gsub(&lt;span class=&quot;comment&quot;&gt;//$/,&quot;&quot;);gsub(/,/,&quot;&quot;); &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;gt;3000&amp;amp;&amp;amp;&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;lt;4000) &lt;span class=&quot;keyword&quot;&gt;exit&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; c4+=&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;END &amp;#123;printf &lt;span class=&quot;string&quot;&gt;&quot;c1=[%d];c2=[%d];c3=[%d];c4=[%d]/n&quot;&lt;/span&gt;,c1,c2,c3,c4&amp;#125;&quot;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;通过&lt;span class=&quot;keyword&quot;&gt;exit&lt;/span&gt;在某条件时退出，但是仍执行END操作。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&amp;#123;gsub(&lt;span class=&quot;comment&quot;&gt;//$/,&quot;&quot;);gsub(/,/,&quot;&quot;); &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;&amp;gt;3000) next; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; c4+=&lt;span class=&quot;variable&quot;&gt;$4&lt;/span&gt;; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;END &amp;#123;printf &lt;span class=&quot;string&quot;&gt;&quot;c4=[%d]/n&quot;&lt;/span&gt;,c4&amp;#125;&quot;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;通过next在某条件时跳过该行，对下一行执行操作。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14、awk &#39;&amp;#123; &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; FILENAME,&lt;span class=&quot;variable&quot;&gt;$0&lt;/span&gt; &amp;#125;&#39; file1 file2 file3&amp;gt;fileall&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;把file1、file2、file3的文件内容全部写到fileall中，格式为打印文件并前置文件名。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15、awk &#39; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;!=previous &amp;#123; &lt;span class=&quot;keyword&quot;&gt;close&lt;/span&gt;(previous); previous=&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;substr&lt;/span&gt;(&lt;span class=&quot;variable&quot;&gt;$0&lt;/span&gt;,&lt;span class=&quot;built_in&quot;&gt;index&lt;/span&gt;(&lt;span class=&quot;variable&quot;&gt;$0&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot; &quot;&lt;/span&gt;) +1)&amp;gt;&lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; fileall&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;把合并后的文件重新分拆为3个文件。并与原文件一致。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16、awk &#39;BEGIN &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;|getline &lt;span class=&quot;keyword&quot;&gt;d&lt;/span&gt;; &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;d&lt;/span&gt;&amp;#125;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;通过管道把date的执行结果送给getline，并赋给变量&lt;span class=&quot;keyword&quot;&gt;d&lt;/span&gt;，然后打印。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17、awk &#39;BEGIN &amp;#123;system(&lt;span class=&quot;string&quot;&gt;&quot;echo &quot;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;Input&lt;/span&gt; your name:&lt;span class=&quot;comment&quot;&gt;//c&quot;&quot;); getline d;print &quot;/nYour name is&quot;,d,&quot;/b!/n&quot;&amp;#125;&#39; &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;通过getline命令交互输入name，并显示出来。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;BEGIN &amp;#123;FS=&lt;span class=&quot;string&quot;&gt;&quot;:&quot;&lt;/span&gt;; &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(getline&amp;lt; &lt;span class=&quot;string&quot;&gt;&quot;/etc/passwd&quot;&lt;/span&gt; &amp;gt;0) &amp;#123; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;~&lt;span class=&quot;string&quot;&gt;&quot;050[0-9]_&quot;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&amp;#125;&#39; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;打印/etc/passwd文件中用户名包含050x_的用户名。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18、awk &#39;&amp;#123; i=1;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(i&amp;lt;NF) &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; NF,&lt;span class=&quot;variable&quot;&gt;$i&lt;/span&gt;;i++&amp;#125;&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;  通过&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;语句实现循环。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    awk &#39;&amp;#123; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(i=1;i&amp;lt;NF;i++) &amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; NF,&lt;span class=&quot;variable&quot;&gt;$i&amp;#125;&lt;/span&gt;&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; 通过&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;语句实现循环。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt;|awk -F &lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt; &#39; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(i=1;i&amp;lt;NF;i++) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(i==NF-1) &amp;#123; printf &lt;span class=&quot;string&quot;&gt;&quot;%s&quot;&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$i&lt;/span&gt; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123; printf &lt;span class=&quot;string&quot;&gt;&quot;%s/&quot;&lt;/span&gt;,&lt;span class=&quot;variable&quot;&gt;$i&lt;/span&gt; &amp;#125; &amp;#125;&amp;#125;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;显示一个文件的全路径。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;用&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;和&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;显示日期 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;BEGIN &amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(j=1;j&amp;lt;=12;j++) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; flag=0; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;printf &lt;span class=&quot;string&quot;&gt;&quot;/n%d月份/n&quot;&lt;/span&gt;,j; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(i=1;i&amp;lt;=31;i++) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (j==2&amp;amp;&amp;amp;i&amp;gt;28) flag=1; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((j==4||j==6||j==9||j==11)&amp;amp;&amp;amp;i&amp;gt;30) flag=1; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (flag==0) &amp;#123;printf &lt;span class=&quot;string&quot;&gt;&quot;%02d%02d &quot;&lt;/span&gt;,j,i&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&#39; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19、在awk中调用系统变量必须用单引号，如果是双引号，则表示字符串 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Flag=abcd &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &#39;&lt;span class=&quot;variable&quot;&gt;$Flag&lt;/span&gt;&#39;&amp;#125;&#39; 结果为abcd &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;awk &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;$Flag&quot;&lt;/span&gt;&amp;#125;&#39; 结果为&lt;span class=&quot;variable&quot;&gt;$Flag&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20. 其他小示例&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;/^(&lt;span class=&quot;keyword&quot;&gt;no&lt;/span&gt;|&lt;span class=&quot;keyword&quot;&gt;so&lt;/span&gt;)/&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----打印所有以模式&lt;span class=&quot;keyword&quot;&gt;no&lt;/span&gt;或&lt;span class=&quot;keyword&quot;&gt;so&lt;/span&gt;开头的行。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;/^[ns]/&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----如果记录以&lt;span class=&quot;keyword&quot;&gt;n&lt;/span&gt;或s开头，就打印这个记录。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; ~/[0-9][0-9]$/(&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&amp;#125;&lt;/span&gt;&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----如果第一个域以两个数字结束就打印这个记录。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; == 100 || &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt; &amp;lt; 50&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----如果第一个或等于100或者第二个域小于50，则打印该行。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; != 10&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----如果第一个域不等于10就打印该行。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;/&lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;/&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; + 10&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----如果记录包含正则表达式&lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;，则第一个域加10并打印出来。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt; &amp;gt; 5 ? &lt;span class=&quot;string&quot;&gt;&quot;ok &quot;&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;)&amp;#125;&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;-----如果第一个域大于5则打印问号后面的表达式值，否则打印冒号后面的表达式值。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ awk &#39;/^root/,/^mysql/&#39; &lt;span class=&quot;keyword&quot;&gt;test&lt;/span&gt;----打印以正则表达式root开头的记录到以正则表达式mysql开头的记录范围内的所有记录。如果找到一个新的正则表达式root开头的记录，则继续打印直到下一个以正则表达式mysql开头的记录为止，或到文件末尾。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="awk" scheme="http://blog.lehoon.cn/tags/awk/"/>
    
      <category term="linux" scheme="http://blog.lehoon.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux epoll学习</title>
    <link href="http://blog.lehoon.cn/backend/2016/07/11/epoll.html"/>
    <id>http://blog.lehoon.cn/backend/2016/07/11/epoll.html</id>
    <published>2016-07-11T02:43:59.000Z</published>
    <updated>2016-07-19T06:52:36.499Z</updated>
    
    <content type="html">&lt;p&gt;在linux的网络编程中，很长的时间都在使用select来做事件触发。在linux新的内核中，有了一种替换它的机制，就是epoll。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;函数简介&lt;br&gt;相比于select，epoll最大的好处在于它不会随着监听fd数目的增长而降低效率。因为在内核中的select实现中，它是采用轮询来处理的，轮询的fd数目越多，自然耗时越多。并且，在linux/posix_types.h头文件有这样的声明：#define __FD_SETSIZE 1024, 表示select最多同时监听1024个fd，当然，可以通过修改头文件再重编译内核来扩大这个数目，但这似乎并不治本。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;接口函数&lt;br&gt;epoll的接口非常简单，一共就三个函数：
&lt;/strong&gt;int epoll_create&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;epoll_create&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; size)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;创建一个epoll的句柄，size用来告诉内核这个监听的数目一共有多大。这个参数不同于select()中的第一个参数，给出最大监听的fd+1的值。需要注意的是，当创建好epoll句柄后，它就是会占用一个fd值，在linux下如果查看/proc/进程id/fd/，是能够看到这个fd的，所以在使用完epoll后，必须调用close()关闭，否则可能导致fd被耗尽。&lt;br&gt;自从Linux 2.6.8开始，size参数被忽略，但是依然要大于0。&lt;br&gt;**int epoll_ctl&lt;br&gt;&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;epoll_ctl&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; epfd, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; op, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; fd, &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; epoll_event *&lt;span class=&quot;keyword&quot;&gt;event&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;epoll的事件注册函数，它不同与select()是在监听事件时告诉内核要监听什么类型的事件，而是在这里先注册要监听的事件类型。第一个参数是epoll_create()的返回值，第二个参数表示动作，用三个宏来表示：&lt;br&gt;EPOLL_CTL_ADD：注册新的fd到epfd中；&lt;br&gt;EPOLL_CTL_MOD：修改已经注册的fd的监听事件；&lt;br&gt;EPOLL_CTL_DEL：从epfd中删除一个fd；&lt;br&gt;第三个参数是需要监听的fd，第四个参数是告诉内核需要监听什么事，struct epoll_event结构如下：&lt;br&gt;struct epoll_event {&lt;br&gt;__uint32_t events; /&lt;em&gt; Epoll events &lt;/em&gt;/&lt;br&gt;epoll_data_t data; /&lt;em&gt; User data variable &lt;/em&gt;/&lt;br&gt;};&lt;br&gt;events可以是以下几个宏的集合：&lt;br&gt;EPOLLIN ：表示对应的文件描述符可以读（包括对端SOCKET正常关闭）；&lt;br&gt;EPOLLOUT：表示对应的文件描述符可以写；&lt;br&gt;EPOLLPRI：表示对应的文件描述符有紧急的数据可读（这里应该表示有带外数据到来）；&lt;br&gt;EPOLLERR：表示对应的文件描述符发生错误；&lt;br&gt;EPOLLHUP：表示对应的文件描述符被挂断；&lt;br&gt;EPOLLET： 将EPOLL设为边缘触发(Edge Triggered)模式，这是相对于水平触发(Level Triggered)来说的。&lt;br&gt;EPOLLONESHOT：只监听一次事件，当监听完这次事件之后，如果还需要继续监听这个socket的话，需要再次把这个socket加入到EPOLL队列里。&lt;br&gt;&lt;em&gt;*int epoll_wait&lt;br&gt;int epoll_wait(int epfd, struct epoll_event &lt;/em&gt; events, int maxevents, int timeout)&lt;br&gt;等待事件的产生，类似于select()调用。参数events用来从内核得到事件的集合，maxevents表示每次能处理的最大事件数，告之内核这个events有多大，这个maxevents的值不能大于创建epoll_create()时的size，参数timeout是超时时间（毫秒，0会立即返回，-1将不确定，也有说法说是永久阻塞）。该函数返回需要处理的事件数目，如返回0表示已超时。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在linux的网络编程中，很长的时间都在使用select来做事件触发。在linux新的内核中，有了一种替换它的机制，就是epoll。&lt;/p&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="linux" scheme="http://blog.lehoon.cn/tags/linux/"/>
    
      <category term="c" scheme="http://blog.lehoon.cn/tags/c/"/>
    
      <category term="epoll" scheme="http://blog.lehoon.cn/tags/epoll/"/>
    
  </entry>
  
  <entry>
    <title>go守护进程实现方式</title>
    <link href="http://blog.lehoon.cn/backend/2016/07/04/golang-deamon.html"/>
    <id>http://blog.lehoon.cn/backend/2016/07/04/golang-deamon.html</id>
    <published>2016-07-04T06:20:51.000Z</published>
    <updated>2016-07-19T06:52:35.578Z</updated>
    
    <content type="html">&lt;p&gt;go 实现守护进程的实现代码。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;代码块&quot;&gt;&lt;a href=&quot;#代码块&quot; class=&quot;headerlink&quot; title=&quot;代码块&quot;&gt;&lt;/a&gt;代码块&lt;/h3&gt;&lt;figure class=&quot;highlight golang&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;package&lt;/span&gt; main&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;log&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;os&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;syscall&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;time&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;daemon&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(nochdir, noclose &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; ret, ret2 &lt;span class=&quot;keyword&quot;&gt;uintptr&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; err syscall.Errno&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    darwin := runtime.GOOS == &lt;span class=&quot;string&quot;&gt;&quot;darwin&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// already a daemon&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; syscall.Getppid() == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// fork off the parent process&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ret, ret2, err = syscall.RawSyscall(syscall.SYS_FORK, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; err != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// failure&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ret2 &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        os.Exit(&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// handle exception for darwin&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; darwin &amp;amp;&amp;amp; ret2 == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ret = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// if we got a good PID, then we call exit the parent process.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ret &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        os.Exit(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/* Change the file mode mask */&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _ = syscall.Umask(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// create a new SID for the child process&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    s_ret, s_errno := syscall.Setsid()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; s_errno != &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        log.Printf(&lt;span class=&quot;string&quot;&gt;&quot;Error: syscall.Setsid errno: %d&quot;&lt;/span&gt;, s_errno)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; s_ret &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; nochdir == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        os.Chdir(&lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; noclose == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        f, e := os.OpenFile(&lt;span class=&quot;string&quot;&gt;&quot;/dev/null&quot;&lt;/span&gt;, os.O_RDWR, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; e == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            fd := f.Fd()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            syscall.Dup2(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;(fd), &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;(os.Stdin.Fd()))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            syscall.Dup2(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;(fd), &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;(os.Stdout.Fd()))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            syscall.Dup2(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;(fd), &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;(os.Stderr.Fd()))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    daemon(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fmt.Println(&lt;span class=&quot;string&quot;&gt;&quot;hello&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        time.Sleep(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; * time.Second)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;go 实现守护进程的实现代码。&lt;br&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="go" scheme="http://blog.lehoon.cn/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>tcp连接负载均衡</title>
    <link href="http://blog.lehoon.cn/backend/2016/07/04/tcp-load-balancing.html"/>
    <id>http://blog.lehoon.cn/backend/2016/07/04/tcp-load-balancing.html</id>
    <published>2016-07-04T06:20:42.000Z</published>
    <updated>2016-07-19T06:52:31.915Z</updated>
    
    <content type="html">&lt;p&gt;tcp连接软件负载均衡一般包括lvs、HaProxy、nginx等，现主要介绍在实际应用中的特点。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;一.   &lt;strong&gt;LVS 性能最强&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;LVS ：Linux Virtual Server（VS），请求对于RealServer（RS）都是透明的（不修改Src），使用内核转发，相比应用实现性能要高很多。&lt;/p&gt;
&lt;p&gt;分为3种模式：&lt;/p&gt;
&lt;p&gt;1、DR：性能最好&lt;/p&gt;
&lt;p&gt;在VS 和RS 使用相同的VIP，RS上抑制ARP。请求通过VS 分发，应答绕过直接回复。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优点&lt;/strong&gt;：性能最高、流量小&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;缺点&lt;/strong&gt;：机器都需要在同一个Vlan下，Real Server 之间无法通过VIP通信。需要抑制VIP ARP 有风险。&lt;/p&gt;
&lt;p&gt;2、IP Tunnel 性能适中&lt;/p&gt;
&lt;p&gt;使用IPIP封包，解决跨Vlan问题，相比DR 就多了一层IP封装，也是只处理请求。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优点&lt;/strong&gt;：跨Vlan&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;缺点&lt;/strong&gt;：虽然应用最为广泛，但windows 不支持IPIP。&lt;/p&gt;
&lt;p&gt;3、NAT&lt;/p&gt;
&lt;p&gt;与前两种相比，不需要绑定VIP，但也要修改路由，RealServer 所有流量都需要经过，需要处理很多无用流量，一般实用性很差。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优点：&lt;/strong&gt;不需要要绑定VIP、跨VLAN&lt;/p&gt;
&lt;p&gt;支持RS 通过VIP访问RS本身，需要对RS做抑制路由操作，所有流量直接发给网关。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;缺点&lt;/strong&gt;：对于请求为SNAT，应答为DNAT。为实现DNAT，需要将RS 的默认网关指向VS&lt;/p&gt;
&lt;p&gt;VS 被当成网关处理，RealServer所有的流量都将发给VS，VS的带宽压力会很大。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;配置工具&lt;/strong&gt;：如果使用ReadHat版本，可以使用&lt;a href=&quot;http://www.linuxvirtualserver.org/docs/ha/piranha.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;strong&gt;Piranha&lt;/strong&gt;&lt;/a&gt; 提供的WEB UI工具配置，配置为需要手动同步一下主板配置。如果需要部署多个实例，而且经常改动，Piranha 将提供很友好的配置环境。&lt;/p&gt;
&lt;p&gt;二. HaProxy 性能高，处理高并发、高连接**&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优点：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1、性能高，20w连接下，处理10w/s请求&lt;/p&gt;
&lt;p&gt; （单进程处理性能1w/s样子，为更好利用多核，多进程模式提升空间很少，需要开启多个实例，这样一来前端必须上LVS负载多个实例端口）&lt;/p&gt;
&lt;p&gt;2、7层、4层都行&lt;/p&gt;
&lt;p&gt;3、不限于VLan ，只要网络策略通即可&lt;/p&gt;
&lt;p&gt;4、可配性高&lt;/p&gt;
&lt;p&gt;5、监控完善&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; 注意点：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1、Src IP被修改，业务中publicIP应该从 x-forward-for中获取（Haproxy也支持透明代理，就像LVS的NAT模式，存在问题）&lt;/p&gt;
&lt;p&gt;2、流量double，千M网卡最多也只能支持500M流量&lt;/p&gt;
&lt;p&gt;3、&lt;span style=&quot;line-height: 1.5;&quot;&gt; 连接数超过65535时，需要考虑绑定多个IP&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;4、Tcp 转发性能要比nginx要好。&lt;/p&gt;
&lt;p&gt;5、HaProxy 是默认单线程、也是最高效方式；也可以支持多线程（进程），但监控会随机请求到的业务、部分功能无法正常使用。&lt;/p&gt;
&lt;p&gt;&lt;span style=&quot;line-height: 1.5;&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;三. Nginx 专注于7层高并发，但不善于处理1w+连接数**&lt;/p&gt;
&lt;p&gt;要支持4层需要另外的patch，而且高连接数时性能无法和haproxy相比。&lt;/p&gt;
&lt;p&gt;默认1个master+ 多个（核心）Worker，可充分利用多核资源。&lt;/p&gt;
&lt;p&gt;Master和worker之间通过进程通信实现，有点像IIS5，相比II6 性能要差些。&lt;/p&gt;
&lt;p&gt;&lt;span style=&quot;line-height: 1.5;&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;**不管HaProxy还是Nginx 都存在一个问题，就是只有一个线程在做Receive，也就是无法均衡软中断。&lt;/p&gt;
&lt;p&gt; 对于主要的四层负载，用户态执行时间很短，性能瓶颈在于主要软中断的处理、多个work其实也无济于事；&lt;/p&gt;
&lt;p&gt; 当然也可以使用redis那样，开启多实例方式。&lt;/p&gt;
&lt;p&gt;四. Windows Server 内置NBL 负载均衡功能**&lt;/p&gt;
&lt;p&gt;原理和LVS的DR相似，但是相比更加暴力，请求使用广播方式，同一个交换机下RS都将受到请求，RS通过一致性算法确认自己改处理请求还是丢弃请求。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;tcp连接软件负载均衡一般包括lvs、HaProxy、nginx等，现主要介绍在实际应用中的特点。&lt;/p&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="linux" scheme="http://blog.lehoon.cn/tags/linux/"/>
    
      <category term="c" scheme="http://blog.lehoon.cn/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>tcp出现rst情况</title>
    <link href="http://blog.lehoon.cn/backend/2016/07/04/tcp-rst.html"/>
    <id>http://blog.lehoon.cn/backend/2016/07/04/tcp-rst.html</id>
    <published>2016-07-04T06:20:33.000Z</published>
    <updated>2016-07-19T06:52:31.267Z</updated>
    
    <content type="html">&lt;p&gt;正常情况tcp四层握手关闭连接，rst基本都是异常情况，整理如下：&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;strong&gt;1.GFW&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.对方端口未打开，发生在连接建立&lt;/strong&gt;&lt;br&gt;  如果对方sync_backlog满了的话，sync简单被丢弃，表现为超时，而不会rst&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.close Socket 时recv buffer 不为空&lt;/strong&gt;&lt;br&gt;  例如，客户端发了两个请求，服务器只从buffer读取第一个请求处理完就关闭连接，tcp层认为数据没有正确提交到应用，使用rst关闭连接。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.移动链路&lt;/strong&gt;&lt;br&gt;  移动网络下，国内是有5分钟后就回收信令，也就是IM产品，如果心跳&amp;gt;5分钟后服务器再给客户端发消息，就会收到rst。也要查移动网络下IM 保持&amp;lt;5min 心跳。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5.负载等设备&lt;/strong&gt;&lt;br&gt;  负载设备需要维护连接转发策略，长时间无流量，连接也会被清除，而且很多都不告诉两层机器，新的包过来时才通告rst。 Apple push 服务也有这个问题，而且是不可预期的偶发性连接被rst；rst 前第一个消息write是成功的，而第二条写才会告诉你连接被重置，曾经被它折腾没辙，因此打开每2秒一次tcp keepalive，固定5分钟tcp连接回收，而且发现连接出错时，重发之前10s内消息。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6.SO_LINGER 应用强制使用rst 关闭&lt;/strong&gt;&lt;br&gt;  该选项会直接丢弃未发送完毕的send buffer，可能造成业务错误，慎用； 当然内网服务间http client 在收到应该时主动关闭，使用改选项，会节省资源。好像曾经测试过haproxy 某种配置下，会使用rst关闭连接，少了网络交互而且没有TIME_WAIT 问题。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;7.超过超时重传次数、网络暂时不可达&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;8.TIME_WAIT 状态&lt;/strong&gt;&lt;br&gt;  tw_recycle = 1 时，sync timestamps 比上次小时，会被rst。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;9.设置 connect_timeout&lt;/strong&gt;&lt;br&gt;  应用设置了连接超时，sync 未完成时超时了，会发送rst终止连接。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;10.非正常包&lt;/strong&gt;&lt;br&gt;  连接已经关闭，seq不正确等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;11.keeplive超时&lt;/strong&gt;&lt;br&gt;  公网服务tcp keeplive最好别打开;移动网络下会增加网络负担，切容易掉线；非移动网络核心ISP设备也不一定都支持keepalive，曾经也发现过广州那边有个核心节点就不支持。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;正常情况tcp四层握手关闭连接，rst基本都是异常情况，整理如下：&lt;/p&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="c" scheme="http://blog.lehoon.cn/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>Linux下tcp的优化</title>
    <link href="http://blog.lehoon.cn/backend/2016/05/26/linux-tcp-optimization.html"/>
    <id>http://blog.lehoon.cn/backend/2016/05/26/linux-tcp-optimization.html</id>
    <published>2016-05-26T11:03:35.000Z</published>
    <updated>2016-07-26T01:11:16.606Z</updated>
    
    <content type="html">&lt;p&gt;在GNU Linux系统中，影响连接个数的因素主是由于单个进程能够打开的最大文件数、端口数量决定的；而一个基于tcp的服务器的并发，除了上文说过的两个因素外，还有因为主要的tcp连接的很多属性，而问题最大的则是连接断开后的连接会在TIME_WAIT状态一直存在60秒，这就造成了在大量高并发的情况下当连接为此TIME_WAIT状态时没有可用连接。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;在GNU Linux系统中，影响连接个数的因素主是由于单个进程能够打开的最大文件数、端口数量决定的；而一个基于tcp的服务器的并发，除了上文说过的两个因素外，还有因为主要的tcp连接的很多属性，而问题最大的则是连接断开后的连接会在TIME_WAIT状态一直存在60秒，这就造成了在大量高并发的情况下当连接为此TIME_WAIT状态时没有可用连接。&lt;br&gt;1、修改端口号范围：&lt;br&gt;默认范围：&lt;br&gt;cat /proc/sys/net/ipv4/ip_local_port_range&lt;br&gt;32768 61000&lt;br&gt;众所周知，端口号的范围为0～65535，知名端口号介于1～255之间，256～1023之间的端口号通常都是由系统占用，所以我们需要更多可以使用的端口号的话，那么就需要修改系统中对端口使用范围变量;&lt;br&gt;修改方法：&lt;br&gt;1）、echo “1024 65535” &amp;gt; /proc/sys/net/ipv4/ip_local_port_range&lt;br&gt;2）、在/etc/sysctl.conf中进行如下的设置：&lt;br&gt;net.ipv4.ip_local_port_range=1024 65535&lt;br&gt;然后执行: sysctl -p 对这些设置进行生效；&lt;br&gt;3）、直接使用命令进行系统变量的优化&lt;br&gt;sysctl -w net.ipv4.ip_local_port_range=1024 65535&lt;br&gt;若端口不够用的时候报错信息&lt;br&gt;若没有空闲的端口可以使用时，将会报错，如：&lt;br&gt;connect() to ip:80 failed (99: Cannot assign requested address)&lt;br&gt;注意：&lt;br&gt;修改了端口的范围后，若是有多个服务在一台设备上时，若是先被其它服务先行启动将另外的服务的“众所周知”的端口给占用了，那么这个问题就比较不太好处理，在这种情况下，对于需要监听的服务进行先行启动，将服务要使用的“众所周知”的端口先行占用，就不会发生比较麻烦的情况了。&lt;br&gt;2、修改系统所有进程能够打开的文件数：&lt;br&gt;cat /proc/sys/fs/file-max&lt;br&gt;203466&lt;br&gt;若要修改的话：&lt;br&gt;echo 403466 &amp;gt; /proc/sys/fs/file-max&lt;br&gt;3、对于处理TIME_WAIT的问题，通过设置以下两项可以极大地提高并发&lt;br&gt;在进行了通信完毕后，完成通信的连接差不多在秒级间就进行了回收，经测试，再使用netstat -ntp，都不会再看到刚才使用的连接，但是在官方文档中说明了（Default value is 0. It should not be changed without advice/request of technical experts.）使用这两种方式需要非常谨慎；如下(修改方法请参看上面的修改方式)：&lt;br&gt;net.ipv4.tcp_tw_reuse = 1&lt;br&gt;//表示开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接，默认为0，表示关闭；&lt;br&gt;net.ipv4.tcp_tw_recycle = 1&lt;br&gt;//表示开启TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭。&lt;br&gt;由于以上两项在官方文档中有这样的描述”It should not be changed without advice/request of technical experts.“，也即是说，这两项在某些情况下会产生负作用或影响；&lt;br&gt;可能出现的影响：&lt;br&gt;net.ipv4.tcp_tw_recycle是与net.ipv4.tcp_timestamps是密切相关的，而net.ipv4.tcp_timestamps默认是开启的，当tcp_tw_recycle和tcp_timestamps同时打开时会激活TCP的一种隐藏属性：缓存连接的时间戳。60秒内，同一源IP的后续请求的时间戳小于缓存中的时间戳，内核就会丢弃该请求。&lt;br&gt;什么样的场景会使时间戳会小于缓存中的时间戳呢？&lt;br&gt;类似的故障场景：&lt;br&gt;多个客户端通过一个NAT访问一台服务器，因为NAT只改IP地址信息，但不会改变timestamp（TCP的时间戳不是系统时间，而是系统启动的时间uptime，所以两台机器的的TCP时间戳一致的可能性很小），那么就会出现请求被丢弃的情况，所以很容易造成连接失败的情况。&lt;br&gt;服务器上开启了tcp_tw_recycle用于TIME_WAIT的快速回收故障现象和分析步骤：&lt;br&gt;1) 通过NAT出口的多个客户端经常请求Web服务器无响应；&lt;br&gt;2) 在服务器抓包，发现服务端可以收到客户端的SYN请求，但是没有回应SYN,ACK，也就是说内核直接将包丢弃了。&lt;br&gt;解决方法：&lt;br&gt;1) 关闭服务其端的tcp_timestamps，故障可以解决，但是这么做存在安全和性能隐患，强烈建议不关闭此变量；&lt;br&gt;2) 关闭tcp_tw_recycle，故障也可以解决。推荐NAT环境下的机器不要开启该选项；&lt;br&gt;3）调整网络拓扑避免NAT的这种类似的情况；&lt;br&gt;4）客户端使用同一个NTP服务进行时间同步，使时间同步避免timestamp差异；&lt;br&gt;其它优化参数&lt;br&gt;net.ipv4.tcp_fin_timeout = 30&lt;br&gt;//表示如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间。&lt;br&gt;net.ipv4.tcp_keepalive_time = 1200&lt;br&gt;//表示当keepalive起用的时候，TCP发送keepalive消息的频度。缺省是2小时，改为20分钟。&lt;br&gt;net.ipv4.tcp_max_tw_buckets = 5000&lt;br&gt;//表示系统同时保持TIME_WAIT套接字的最大数量，如果超过这个数字，&lt;br&gt;//TIME_WAIT套接字将立刻被清除并打印警告信息。默认为180000，改为5000。&lt;br&gt;//对于Apache、Nginx等服务器，上几行的参数可以很好地减少TIME_WAIT套接字数量，&lt;br&gt;//此值和/proc/sys/net/ipv4/tcp_max_syn_backlog是一样的，也是对listen()函数中的backlog参数的限制，按照文档中的说明，应该最好是设置成和/proc/sys/net/ipv4/tcp_max_syn_backlog一样的值，此值的默认值是128：&lt;br&gt;cat /proc/sys/net/core/somaxconn&lt;br&gt;128&lt;br&gt;net.core.somaxconn = 40000&lt;br&gt;//指定未完成连接队列的最大长度，默认为1024个，是对socket的listen()函数中的backlog数量的限制，若服务器过载可以增大此值；&lt;br&gt;cat /proc/sys/net/ipv4/tcp_max_syn_backlog&lt;br&gt;1024&lt;br&gt;net.ipv4.tcp_max_syn_backlog = 40000&lt;br&gt;4、调整每个进程最大打开文件描述符限制&lt;br&gt;调整文件描述符限制:&lt;br&gt;$ ulimit -n&lt;br&gt;1024&lt;br&gt;修改此值，ulimit -n 4096&lt;br&gt;$vi /etc/security/limits.conf&lt;br&gt;//Setting Shell Limits for File Descriptors&lt;br&gt;&lt;em&gt;soft nofile 8192
&lt;/em&gt;hard nofile 8192&lt;br&gt;这二者的区别，在/etc/security/limits.conf配置文件中配置好后，进行重启后再次使用ulimit -n将得到的值是8192.&lt;br&gt;5、通过重新编译内核代码减少TCP连接的TIME-WAIT时间&lt;br&gt;在内核代码中的include/net/tcp.h文件中，TIME-WAIT的定义如下：&lt;br&gt;&lt;figure class=&quot;highlight pf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;//&lt;span class=&quot;comment&quot;&gt;#define TCP_TIMEWAIT_LEN (60*HZ) /* how long to wait to destroy TIME-WAIT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* &lt;span class=&quot;keyword&quot;&gt;state&lt;/span&gt;, about &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt; seconds */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以通过修改TCP_TIMEWAIT_LEN的值，来加快连接的释放；修改后，内核进行编译后进行替换。&lt;br&gt;Nginx的配置与系统环境变量间的关系&lt;br&gt;系统默认的是1024，若在Nginx的配置文件中，配置了worker_connections 4096;后，再启动时，会出现这样的一个警告:&lt;br&gt;nginx: [warn] 4096 worker_connections exceed open file resource limit: 1024&lt;br&gt;Nginx中的这些和系统变量有关的，是根据系统中的配置而进行设置的，若大于了系统变量的范围的话，不会生效，会被默认成系统的值，如每个worker进行能够打开的文件数量就被默认成系统的值1024；&lt;br&gt;注意：&lt;br&gt;修改内核变量是有风险的，最好是在测试环境进行测试通过，再将配置平移到生产环境。&lt;br&gt;REF:&lt;br&gt;IPV4和IPV6的内核参数各项的意义及取值：&lt;br&gt;&lt;a href=&quot;https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt&lt;/a&gt;&lt;br&gt;关于/proc目录下的主要项的介绍：&lt;br&gt;&lt;a href=&quot;http://man7.org/linux/man-pages/man5/proc.5.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://man7.org/linux/man-pages/man5/proc.5.html&lt;/a&gt;&lt;br&gt;如果你在工作和学习中有什么技术问题和困难，请关注大数据架构师微信公众号xinsz08，并留言，我们会努力帮你解答，每天1篇必读运维大牛亲笔绝密干货贴，尽在大数据架构师专家，1000万IT人的必备资源库。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在GNU Linux系统中，影响连接个数的因素主是由于单个进程能够打开的最大文件数、端口数量决定的；而一个基于tcp的服务器的并发，除了上文说过的两个因素外，还有因为主要的tcp连接的很多属性，而问题最大的则是连接断开后的连接会在TIME_WAIT状态一直存在60秒，这就造成了在大量高并发的情况下当连接为此TIME_WAIT状态时没有可用连接。&lt;/p&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="linux" scheme="http://blog.lehoon.cn/tags/linux/"/>
    
      <category term="tcp" scheme="http://blog.lehoon.cn/tags/tcp/"/>
    
      <category term="optimization" scheme="http://blog.lehoon.cn/tags/optimization/"/>
    
  </entry>
  
  <entry>
    <title>oracle中merge into语法注意点</title>
    <link href="http://blog.lehoon.cn/orther/2016/05/08/oracle-merge-into.html"/>
    <id>http://blog.lehoon.cn/orther/2016/05/08/oracle-merge-into.html</id>
    <published>2016-05-08T08:09:00.000Z</published>
    <updated>2016-07-19T06:52:33.214Z</updated>
    
    <content type="html">&lt;p&gt;在进行SQL语句编写时，我们经常会遇到大量的同时进行Insert/Update的语句，就是说当存在记录时，就更新(Update)，不存在数据时，就插入(Insert)。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;在进行SQL语句编写时，我们经常会遇到大量的同时进行Insert/Update的语句，就是说当存在记录时，就更新(Update)，不存在数据时，就插入(Insert)。&lt;/p&gt;
&lt;p&gt;接下来我们有一个任务，有一个表T，有两个字段a,b，我们想在表T中做Insert/Update,如果存在，则更新T中b的值，如果不存在，则插入一条记录。在Microsoft的SQL语法中，很简单的一句判断就可以了，SQL Server中的语法如下：&lt;br&gt;if exists(select 1 from T where T.a=’1001’ ) update T set T.b=2 Where T.a=’’1001’’ else insert into T(a,b) values(‘1001’,2);&lt;br&gt;以上语句表明当T表中如果存在a=’1001’ 的记录的话，就把b的值设为2，否则就Insert一条a=’’100’’，b=2的记录到T中。&lt;br&gt;但是接下来在Oracle中就遇到麻烦了，记得在Oracle 9i之后就有一条Merge into 的语句可以同时进行Insert 和Update的吗，Merge的语法如下：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;MERGE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;INTO&lt;/span&gt; table_name alias1    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;USING&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt;|&lt;span class=&quot;keyword&quot;&gt;view&lt;/span&gt;|sub_query) alias2   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;ON&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt; condition)    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;MATCHED&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;THEN&lt;/span&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;UPDATE&lt;/span&gt; table_name    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; col1 = col_val1,    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     col2 = col2_val    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;MATCHED&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;THEN&lt;/span&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;INSERT&lt;/span&gt; (column_list) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt; (column_values);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上面的语法大家应该都容易懂吧，那我们按照以上的逻辑再写一次。&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;MERGE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;INTO&lt;/span&gt; T T1   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;USING&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; a,b &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; T &lt;span class=&quot;keyword&quot;&gt;WHERE&lt;/span&gt; t.a=&lt;span class=&quot;string&quot;&gt;&#39;1001&#39;&lt;/span&gt;) T2   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;ON&lt;/span&gt; ( T1.a=T2.a)   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;MATCHED&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;THEN&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;UPDATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; T1.b = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;MATCHED&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;THEN&lt;/span&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT&lt;/span&gt; (a,b) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;1001&#39;&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以上的语句貌似很对是吧，实际上，该语句只能进行更新，而无法进行Insert，错误在哪里呢？其实在Oracle中Merge语句原先是用来进行整表的更新用的，也就是ETL工具比较常用的语法，重点是在Using上。&lt;br&gt;用中文来解释Merge语法，就是：&lt;br&gt;在alias2中Select出来的数据，每一条都跟alias1进行 ON (join condition)的比较，如果匹配，就进行更新的操作(Update),如果不匹配，就进行插入操作(Insert)。&lt;br&gt;因此，严格意义上讲，”在一个同时存在Insert和Update语法的Merge语句中，总共Insert/Update的记录数，就是Using语句中alias2的记录数。”&lt;br&gt;以上这句话也就很好的解释了在上面写的语句为何只能进行Update，而不能进行Insert了，因为都Select不到数据，如何能进行Insert呢:)&lt;br&gt;接下来要改成正确的语句就容易多了，如下：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;MERGE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;INTO&lt;/span&gt; T T1   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;USING&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;1001&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;AS&lt;/span&gt; a,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;AS&lt;/span&gt; b &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; dual) T2   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;ON&lt;/span&gt; ( T1.a=T2.a)   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;MATCHED&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;THEN&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;UPDATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; T1.b = T2.b   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;MATCHED&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;THEN&lt;/span&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT&lt;/span&gt; (a,b) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(T2.a,T2.b);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样查询就对了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在进行SQL语句编写时，我们经常会遇到大量的同时进行Insert/Update的语句，就是说当存在记录时，就更新(Update)，不存在数据时，就插入(Insert)。&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="oracle" scheme="http://blog.lehoon.cn/tags/oracle/"/>
    
      <category term="merge" scheme="http://blog.lehoon.cn/tags/merge/"/>
    
  </entry>
  
  <entry>
    <title>机动车驾驶科目三操作要领</title>
    <link href="http://blog.lehoon.cn/orther/2015/10/11/kesankaoshi.html"/>
    <id>http://blog.lehoon.cn/orther/2015/10/11/kesankaoshi.html</id>
    <published>2015-10-11T11:08:58.000Z</published>
    <updated>2016-07-19T06:52:34.371Z</updated>
    
    <content type="html">&lt;p&gt;机动车驾驶科目三操作要领.&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;一、“报告”递档案，等待语音提示考试开始或者说考试开始，逆时针绕车一圈半，注意观察周围情况，在车的做前脚观察左中右道路情况，在车右后角观察车辆道路的情况。检查完毕后，回到驾驶员车门处，喊“报告考官，请求上车”。考官允许后观察后方是否安全，时间不少于3秒，确认安全后开门上车。&lt;/p&gt;
&lt;p&gt;二、上车后，确认车门安全关闭后，先踩刹车、后踩离合、调整座椅、调整左中右后视镜、系安全带、检查手刹、退空档、启动点火。&lt;br&gt;1、调整座椅&lt;br&gt;2、看左中右后视镜&lt;br&gt;3、系安全带&lt;br&gt;4、检查手刹&lt;br&gt;5、退空档&lt;br&gt;6、点火&lt;/p&gt;
&lt;p&gt;三、灯光，模拟夜间考试开始：照明不良条件下行驶（开启灯光）。&lt;br&gt;1、夜间在没有路灯，照明不良条件下行驶（开启远光灯）&lt;br&gt;2、夜间同方向近距离跟车行驶（开启近光灯）&lt;br&gt;3、请将前照灯变为远光（开启近光灯）&lt;br&gt;4、夜间在窄路和非机动车会车（开启近光灯）&lt;br&gt;5、夜间通过急转弯（变换远近光灯）&lt;br&gt;6、夜间通过坡路（变换远近光灯）&lt;br&gt;7、夜间通过拱桥（变换远近光灯）&lt;br&gt;8、夜间通过人行横道（变换远近光灯）&lt;br&gt;9、夜间通过没有交通信号灯控制的路口（变换远近光灯）&lt;br&gt;10、夜间超越前方车辆（变换远近光灯）&lt;br&gt;11、夜间进入照明良好道路（开启近光灯）&lt;br&gt;12、夜间进入照片不良道路（开启远光灯）&lt;br&gt;13、夜间与机动车会车（变换远近光灯）&lt;br&gt;14、夜间在路边临时停车（开启四闪、开小灯）&lt;br&gt;15、夜间在道路上发生故障妨碍交通难以移动时（开四闪、开小灯）&lt;br&gt;16、雾天行驶（开雾灯、开四闪）&lt;/p&gt;
&lt;p&gt;模拟夜间考试完毕，请关闭所有灯光，请起步，继续完成开始。&lt;/p&gt;
&lt;p&gt;四、此时喊“报告考官，各仪表工作正常，请求起步”，考官同意后，起步顺序如下：&lt;br&gt;1、踩离合器&lt;br&gt;2、挂一档&lt;br&gt;3、拨转向灯（左转向）&lt;br&gt;4、鸣喇叭&lt;br&gt;5、看左中右后视镜&lt;br&gt;6、松手刹&lt;br&gt;7、方向盘左打2指（看左后视镜）&lt;br&gt;8、慢抬停住离合、松脚刹（抬离合要领，慢、停、慢）&lt;br&gt;10、起步成功，回转向灯，回正方向&lt;/p&gt;
&lt;p&gt;五、变更车道&lt;br&gt;打左转向灯，看左中右后视镜，方向盘左动2指，车发生斜度以后，回正方向，再此看后视镜，进入车道，车正后回转方向灯。&lt;/p&gt;
&lt;p&gt;六、直线行驶&lt;br&gt;直线行驶过程中方向不能跑偏，不能随意晃动方向盘，视情况加速加档，遇情况时先减速。&lt;/p&gt;
&lt;p&gt;七、通过学校区域、人行横道、路口、公共汽车站（先松油门，把右脚挪到刹车踏板，左右把头观察情况，把头幅度要大）。&lt;/p&gt;
&lt;p&gt;八、前方路口右转弯，操作要领：&lt;br&gt;1、打右转向灯，收油门减速&lt;br&gt;2、看中后视镜&lt;br&gt;3、方向盘右动2指&lt;br&gt;4、踩刹车减速，进入车道后，逐级减档&lt;br&gt;5、根据路口大小，打方向，扭头看右后方，进入辅道&lt;/p&gt;
&lt;p&gt;九、前方路口左转&lt;br&gt;1、打左转向灯&lt;br&gt;2、看中左后视镜&lt;br&gt;3、根据路口大小打方向，扭头看左前方，进入一车道&lt;/p&gt;
&lt;p&gt;十、掉头&lt;br&gt;听到指令后，观察前方道路，逐级变道，选择有导向箭头或者有人行横道的路口选择掉头。&lt;/p&gt;
&lt;p&gt;十一、靠边停车&lt;br&gt;1、打右转向灯&lt;br&gt;2、收油门减速&lt;br&gt;3、看中右后试镜&lt;br&gt;3、方向盘右动2指&lt;br&gt;4、踩刹车减速，进入车道，逐级减速减档，减至一档，再次看中右后视镜，找边线停车。&lt;br&gt;注意：每减一档，离合器必须抬起，在最短的距离内选点停车。&lt;/p&gt;
&lt;p&gt;十二、车停止后，拉手刹、退空挡、回转向灯、熄火、别一档、摘安全带、说“报告考官，操作完毕，请求下车”。&lt;br&gt;要领：拉、退、回、熄、别、摘。&lt;/p&gt;
&lt;p&gt;十三、考官准许后，先退座椅，扭身先看左后视镜，再看左后方确认安全后右手开车门下车。下车后双手轻关车门，确认车门完全关闭后从车头绕回，到右侧前车窗处，说“谢谢考官”，领回档案。&lt;/p&gt;
&lt;p&gt;十四、在行驶过程中如果让自己的车辆改变行驶方向，必须打-看-动-回（打：打转向灯，警告后面的车辆，看：看后视镜，看后面车辆距离近远，动：动2指方向，回：回转向灯）&lt;/p&gt;
&lt;p&gt;十五、车速判断：一档：0~10公里。二档：10~20公里。三档：20~30公里。四档：30~40公里。五档：40公里以上。上坡路段加5公里，下坡路段减5公里。还有一种方法是看转速表，转速达到1500~2000转，就可以换挡。&lt;/p&gt;
&lt;p&gt;十六、起步、变向、变更车道、超车、靠边停车、打转向灯、三秒后才能动方向盘。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;机动车驾驶科目三操作要领.&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="科三" scheme="http://blog.lehoon.cn/tags/%E7%A7%91%E4%B8%89/"/>
    
      <category term="考试" scheme="http://blog.lehoon.cn/tags/%E8%80%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>window服务编程</title>
    <link href="http://blog.lehoon.cn/backend/2015/09/28/window-service-program.html"/>
    <id>http://blog.lehoon.cn/backend/2015/09/28/window-service-program.html</id>
    <published>2015-09-28T11:40:18.000Z</published>
    <updated>2016-07-28T01:53:58.623Z</updated>
    
    <content type="html">&lt;p&gt;window下编写服务程序样例。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;119&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;120&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;121&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;122&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;123&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;124&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;125&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;126&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;127&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;128&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;129&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;130&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;131&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;132&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;133&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;134&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;135&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;136&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;137&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;138&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;139&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;140&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;141&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;142&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;143&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;144&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;145&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;146&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;147&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;148&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;149&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;150&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;151&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;152&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;153&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;154&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;155&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;156&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;157&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;158&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;159&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;160&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;161&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;162&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;163&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;164&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;165&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;166&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;167&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;168&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;169&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;170&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;171&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;172&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;173&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;174&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;175&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;176&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;177&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;178&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;179&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;180&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;181&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;182&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;183&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;184&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;185&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;186&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;187&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;188&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;189&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;190&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;191&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;193&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;194&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;195&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;196&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;197&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;198&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;199&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;200&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;201&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;202&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;203&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;204&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;205&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;206&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;207&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;208&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;209&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;210&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;211&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;212&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;213&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;214&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;215&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;216&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;218&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;219&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;220&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;221&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;222&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;223&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;224&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;225&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;226&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;227&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;228&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;229&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;230&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;231&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;232&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;233&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;234&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;235&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;236&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;237&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;238&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;239&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;240&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;241&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;242&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;243&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;244&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;245&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;246&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;247&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;248&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;249&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;250&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;251&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;252&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;253&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;254&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;256&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;257&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;258&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;259&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;260&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;261&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;262&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;263&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;264&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;265&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;266&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;267&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;268&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;269&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;270&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;271&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;272&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;273&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;274&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;275&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;276&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;277&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;278&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;279&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;280&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;281&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;282&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;283&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;284&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;285&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;286&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;287&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;288&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;289&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;290&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;291&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;292&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;293&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;294&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;295&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;296&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;297&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;298&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;299&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;300&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;301&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;302&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;303&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;304&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;305&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;306&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;307&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;308&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;309&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;310&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;311&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;312&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;313&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;314&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;315&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;316&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;317&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;318&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;319&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;320&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;321&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;322&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;323&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;324&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;325&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;326&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;327&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;328&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;329&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;330&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;331&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;332&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;333&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;334&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;335&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;336&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;337&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;338&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;339&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;340&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;341&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;342&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;343&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;344&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;345&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;346&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;347&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;348&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;349&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;350&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;351&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;352&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;353&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;354&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;355&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;356&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;357&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;358&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;359&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;360&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;361&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;362&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;363&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;364&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;365&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;366&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;367&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;368&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;369&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;370&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;371&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;372&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;373&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;374&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;375&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;376&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;377&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;378&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;380&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;381&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;382&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;383&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;384&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;385&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;386&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;387&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;388&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;389&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;390&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;391&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;392&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;393&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;394&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;395&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;396&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;397&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;398&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;399&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;400&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;401&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;402&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;403&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;404&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;405&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;406&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;407&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;408&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;409&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;410&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;411&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;412&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;413&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;414&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;415&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;416&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;417&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;418&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;419&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;420&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;421&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;422&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;423&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;424&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;425&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;426&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;427&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;428&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;429&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;430&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;431&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;432&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;433&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;434&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;435&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;436&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;437&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;438&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;439&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;440&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;441&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;442&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;443&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;444&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;445&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;446&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;447&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;448&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;449&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;450&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;451&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;452&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;453&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;454&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;455&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;456&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;457&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;458&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;459&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;460&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;461&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;462&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;463&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;464&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;465&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;466&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;467&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;468&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;469&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;470&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;471&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;472&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;473&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;474&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;475&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;476&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;477&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;478&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;479&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;480&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;481&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;482&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;483&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;484&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;485&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;486&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;487&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;488&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;489&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;490&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;491&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;492&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;493&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;494&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;495&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;496&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;497&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;498&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;499&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;500&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;501&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;502&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;503&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;504&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;505&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;506&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;507&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;508&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;509&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;510&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;511&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;512&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;513&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;514&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;515&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;516&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;517&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;518&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;519&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;pragma&lt;/span&gt; once&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;windows.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;tchar.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;comutil.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SLEEP_TIME 5000&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; LOGFILE &lt;span class=&quot;meta-string&quot;&gt;&quot;d:\\ITXBaseProviderService.txt&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;    * ServiceName=&lt;span class=&quot;string&quot;&gt;&quot;ITXBaseProviderService&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; EnumRunState&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     None=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     Running=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     Stoped=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     Pause=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;EnumRunState RunState;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;WriteToLog&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* str)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    FILE* &lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;=fopen(LOGFILE,&lt;span class=&quot;string&quot;&gt;&quot;a+&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;==&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;)  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;fprintf&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;%s\n&quot;&lt;/span&gt;,str);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fclose(&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//定义变量和方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;SERVICE_STATUS ServiceStatus;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;SERVICE_STATUS_HANDLE hStatus;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;HANDLE terminateEvent; &lt;span class=&quot;comment&quot;&gt;//事件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;HANDLE threadHandle;   &lt;span class=&quot;comment&quot;&gt;//线程&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;terminate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DWORD error)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ServiceMain&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc,&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;** argv)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ControlHandler&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DWORD request)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InitService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;BOOL &lt;span class=&quot;title&quot;&gt;RunService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * sSvcName)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;ResumeService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;PauseService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;StopService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;BOOL &lt;span class=&quot;title&quot;&gt;SendStatusToSCM&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(DWORD dwCurrentState,&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwWin32ExitCode, &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwServiceSpecificExitCode,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwCheckPoint,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwWaitHint);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InstallService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UninstallService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;DWORD WINAPI &lt;span class=&quot;title&quot;&gt;ServiceThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LPDWORD param)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//安装入口点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* argv[])&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    SERVICE_TABLE_ENTRY ServiceTable[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//设置服务名称和服务入口函数  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceTable[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].lpServiceName = ServiceName;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceTable[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].lpServiceProc = (LPSERVICE_MAIN_FUNCTION)ServiceMain;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceTable[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;].lpServiceName = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceTable[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;].lpServiceProc = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//引数 &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(argc&amp;lt;=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;使用方法:&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;\&quot;install\&quot;&quot;&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;or&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;\&quot;uninstall\&quot;&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;\&quot;exec \&quot;&quot;&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot; parameter required in the command line&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;endl&lt;/span&gt;;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(argc&amp;gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;stricmp(&lt;span class=&quot;string&quot;&gt;&quot;install&quot;&lt;/span&gt;,argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])==&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#123;   &lt;span class=&quot;comment&quot;&gt;//install(InstallService)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              InstallService(); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;installService Succed!&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#125;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;stricmp(&lt;span class=&quot;string&quot;&gt;&quot;uninstall&quot;&lt;/span&gt;,argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])==&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#123;   &lt;span class=&quot;comment&quot;&gt;//uninstall(UninstallService) &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              UninstallService(); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;UninstallService Succed!&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#125;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;stricmp(&lt;span class=&quot;string&quot;&gt;&quot;exec&quot;&lt;/span&gt;,argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])==&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#123;   &lt;span class=&quot;comment&quot;&gt;//exec(ServiceMain)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              RunService(ServiceName);         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#123;    &lt;span class=&quot;comment&quot;&gt;//usage(使用方法)表示&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;使用方法 :&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;//&quot;install&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;\&quot;install\&quot;&quot;&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;//&quot;or&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;or&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;//&quot;uninstall&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;\&quot;uninstall\&quot;&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;//&quot;exec&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;\&quot;exec \&quot;&quot;&lt;/span&gt;; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;//&quot;or&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot;or&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;cout&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&quot; parameter required in the command line&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//-------------------------------------------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//启动服务的控制分派机线程(启动并执行一个新线程)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     StartServiceCtrlDispatcher(ServiceTable);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//服务入口点(主线程)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ServiceMain&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc,&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;** argv)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; success;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//开始服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RunService(ServiceName);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//注册服务控制处理函数&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   hStatus = RegisterServiceCtrlHandler(ServiceName,(LPHANDLER_FUNCTION)ControlHandler);   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!hStatus)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;ServiceMain函数中注册服务控制处理函数失败!\n&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//向SCM报告工作状态&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RunState=EnumRunState::Running;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceStatus.dwCurrentState=SERVICE_RUNNING;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceStatus.dwServiceType=SERVICE_WIN32;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServiceStatus.dwControlsAccepted = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ACCEPT_STOP |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ACCEPT_PAUSE_CONTINUE |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ACCEPT_SHUTDOWN;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/*SetServiceStatus(hStatus,&amp;amp;ServiceStatus);*/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;////启动工作循环(这个模块在另外一个线程中执行)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//while(RunState==EnumRunState::Running)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//  WriteToLog(&quot;ServiceMain函数写日志\n&quot;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//     Sleep(500);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//&amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//创建一个终结事件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   terminateEvent = CreateEvent (&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,TRUE,FALSE,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!terminateEvent)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       terminate(GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   success =  SendStatusToSCM(SERVICE_START_PENDING,NO_ERROR,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        terminate(GetLastError()); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//初始化&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   success =  InitService();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        terminate(GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   success = SendStatusToSCM(SERVICE_RUNNING,NO_ERROR,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        terminate(GetLastError()); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//等待停止&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   WaitForSingleObject ( terminateEvent, INFINITE);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   terminate(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;ServiceMain函数执行完毕!&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//服务控制台命令处理函数&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ControlHandler&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DWORD request)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD  currentState = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   BOOL success; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;ControlHandler:&quot;&lt;/span&gt;+request);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt;(request)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; SERVICE_CONTROL_STOP:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            RunState=EnumRunState::Stoped;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            currentState = SERVICE_STOP_PENDING;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            ServiceStatus.dwCurrentState=currentState;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SetServiceStatus(hStatus,&amp;amp;ServiceStatus);           &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            StopService();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; SERVICE_CONTROL_PAUSE:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             RunState=EnumRunState::Pause;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             currentState = SERVICE_PAUSED;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             ServiceStatus.dwCurrentState=currentState;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             SetServiceStatus(hStatus,&amp;amp;ServiceStatus);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             PauseService();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; SERVICE_CONTROL_CONTINUE:   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           RunState=EnumRunState::Running;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             currentState = SERVICE_RUNNING;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             ServiceStatus.dwCurrentState=currentState;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             SetServiceStatus(hStatus,&amp;amp;ServiceStatus);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             ResumeService();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; SERVICE_CONTROL_INTERROGATE:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// it will fall to bottom and send status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Do nothing in a shutdown. Could do cleanup&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// here but it must be very quick.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; SERVICE_CONTROL_SHUTDOWN:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Do nothing on shutdown          &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//ServiceStatus.dwCurrentState=currentState;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//SetServiceStatus(hStatus,&amp;amp;ServiceStatus);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//初始化服务(开始服务时执行)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InitService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//写日志信息&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   result=WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Monitoring started.&quot;&lt;/span&gt;); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//开始一个线程 Start the service&#39;s thread&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD id;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   threadHandle = CreateThread(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,(LPTHREAD_START_ROUTINE)ServiceThread,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &amp;amp;id);   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (threadHandle==&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       result=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#123;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       result=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;InitService一个线程开始了!&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;DWORD WINAPI &lt;span class=&quot;title&quot;&gt;ServiceThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LPDWORD param)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//线程操作&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(RunState==EnumRunState::Running)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;线程中写日志\n&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Sleep(&lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;线程操作ServiceThread完成!&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;BOOL &lt;span class=&quot;title&quot;&gt;RunService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * sSvcName)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   SC_HANDLE schSCManager;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   SC_HANDLE scHandle;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   BOOL boolRet;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// open to SCM   &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   schSCManager = OpenSCManager(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        SC_MANAGER_ALL_ACCESS &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//Open&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   scHandle = OpenService(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        schSCManager,              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sSvcName, &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        SERVICE_ALL_ACCESS  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//start &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   boolRet = StartService(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        scHandle,          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; boolRet;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;ResumeService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//pauseService=FALSE;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//ResumeThread(threadHandle);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;PauseService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//pauseService = TRUE;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//SuspendThread(threadHandle);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;StopService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RunState=EnumRunState::Stoped;&lt;span class=&quot;comment&quot;&gt;//=FALSE;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Set the event that is holding ServiceMain&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// so that ServiceMain can return&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   SetEvent(terminateEvent);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//安装/反安装函数&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InstallService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     SC_HANDLE schService; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     SC_HANDLE schSCManager; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; szPath[&lt;span class=&quot;number&quot;&gt;512&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt; userName = &lt;span class=&quot;string&quot;&gt;&quot;NT AUTHORITY\\NetworkService&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//Install Starting... &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//获取模块文件路径名称&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!GetModuleFileName(&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,szPath,&lt;span class=&quot;number&quot;&gt;512&lt;/span&gt;)) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// open to SCM　&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     schSCManager = OpenSCManager( &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// pointer to machine name string&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// pointer to database name string&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                SC_MANAGER_CREATE_SERVICE &lt;span class=&quot;comment&quot;&gt;// type of access&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!schSCManager)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;OpenScManagerErrorID:&quot;&lt;/span&gt; + GetLastError());  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Install 新服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     schService = CreateService(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            schSCManager, &lt;span class=&quot;comment&quot;&gt;// handle to service control manager database&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            ServiceName, &lt;span class=&quot;comment&quot;&gt;// pointer to name of service to start&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            ServiceName, &lt;span class=&quot;comment&quot;&gt;// pointer to display name     &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ALL_ACCESS,&lt;span class=&quot;comment&quot;&gt;// type of access to service&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_WIN32_OWN_PROCESS,&lt;span class=&quot;comment&quot;&gt;// type of service&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_DEMAND_START,&lt;span class=&quot;comment&quot;&gt;// when to start service&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ERROR_NORMAL,&lt;span class=&quot;comment&quot;&gt;// severity if service fails to start&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            szPath,       &lt;span class=&quot;comment&quot;&gt;// pointer to name of binary file&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;// pointer to name of load ordering group&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;// pointer to variable to get tag identifier&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;// pointer to array of dependency names&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            userName.c_str(),         &lt;span class=&quot;comment&quot;&gt;// pointer to account name of service&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;          &lt;span class=&quot;comment&quot;&gt;// pointer to password for service account&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!schService)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;CreateServiceErrorID:&quot;&lt;/span&gt;+GetLastError()); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Service installed\n&quot;&lt;/span&gt;); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     CloseServiceHandle(schService);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     CloseServiceHandle(schSCManager);   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Install Ending...\n&quot;&lt;/span&gt;); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UninstallService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     SC_HANDLE schService;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     SC_HANDLE schSCManager; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     BOOL success;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     SERVICE_STATUS svcStatus;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Uninstall Starting...&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// open to SCM　&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     schSCManager = OpenSCManager(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;// pointer to machine name string &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;// pointer to database name string&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SC_MANAGER_CREATE_SERVICE &lt;span class=&quot;comment&quot;&gt;// type of access&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!schSCManager)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;OpenScManagerErrorID:&quot;&lt;/span&gt;+GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//打开一个服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     schService = OpenService(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  schSCManager,              &lt;span class=&quot;comment&quot;&gt;// handle to service control manager database&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  ServiceName,              &lt;span class=&quot;comment&quot;&gt;// pointer to name of service to start&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  SERVICE_ALL_ACCESS | DELETE&lt;span class=&quot;comment&quot;&gt;// type of access to service&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!schService)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;OpenServiceErrorID:&quot;&lt;/span&gt;+GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//(if necessary)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     success = QueryServiceStatus(schService, &amp;amp;svcStatus);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;In QueryServiceStatus ErrorID:&quot;&lt;/span&gt;+GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (svcStatus.dwCurrentState != SERVICE_STOPPED)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Stopping service...&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           success = ControlService(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               schService,           &lt;span class=&quot;comment&quot;&gt;// handle to service&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               SERVICE_CONTROL_STOP, &lt;span class=&quot;comment&quot;&gt;// control code&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &amp;amp;svcStatus            &lt;span class=&quot;comment&quot;&gt;// pointer to service status structure&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;In ControlServiceErrorID:&quot;&lt;/span&gt;+GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//等待&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          QueryServiceStatus(schService,&amp;amp;svcStatus);      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          Sleep(&lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;);    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(SERVICE_STOP_PENDING==svcStatus.dwCurrentState);        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(SERVICE_STOPPED!=svcStatus.dwCurrentState)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Failed to Stop Service ErrorID:&quot;&lt;/span&gt;+GetLastError());  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//删除服务 &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     success = DeleteService(schService);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Service removed\n&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;In DeleteService ErrorID:&quot;&lt;/span&gt;+GetLastError());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;//Clean up&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     CloseServiceHandle(schService);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     CloseServiceHandle(schSCManager);   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     WriteToLog(&lt;span class=&quot;string&quot;&gt;&quot;Uninstal Ending...&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;BOOL &lt;span class=&quot;title&quot;&gt;SendStatusToSCM&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(DWORD dwCurrentState,&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwWin32ExitCode, &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwServiceSpecificExitCode,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwCheckPoint,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   DWORD dwWaitHint)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       BOOL success;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       SERVICE_STATUS serviceStatus;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// Fill in all of the SERVICE_STATUS fields&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       serviceStatus.dwServiceType =SERVICE_WIN32_OWN_PROCESS;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       serviceStatus.dwCurrentState = dwCurrentState;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// If in the process of something, then accept&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// no control events, else accept anything&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (dwCurrentState == SERVICE_START_PENDING)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            serviceStatus.dwControlsAccepted = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            serviceStatus.dwControlsAccepted = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ACCEPT_STOP |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ACCEPT_PAUSE_CONTINUE |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            SERVICE_ACCEPT_SHUTDOWN;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// if a specific exit code is defines, set up&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// the win32 exit code properly&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (dwServiceSpecificExitCode == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            serviceStatus.dwWin32ExitCode =dwWin32ExitCode;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            serviceStatus.dwWin32ExitCode = ERROR_SERVICE_SPECIFIC_ERROR;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       serviceStatus.dwServiceSpecificExitCode =dwServiceSpecificExitCode;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       serviceStatus.dwCheckPoint = dwCheckPoint;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       serviceStatus.dwWaitHint = dwWaitHint;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// Pass the status record to the SCM&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;//SERVICE_STATUS_HANDLE serviceStatusHandle;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       success = SetServiceStatus (hStatus,&amp;amp;serviceStatus);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          StopService();     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; success;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;VOID &lt;span class=&quot;title&quot;&gt;terminate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DWORD error)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// if terminateEvent has been created, close it.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (terminateEvent)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CloseHandle(terminateEvent);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Send a message to the scm to tell about&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// stop age&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hStatus)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    SendStatusToSCM(SERVICE_STOPPED, error,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// If the thread has started kill it off&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (threadHandle)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CloseHandle(threadHandle);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Do not need to close serviceStatusHandle&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;window下编写服务程序样例。&lt;br&gt;
    
    </summary>
    
      <category term="后端" scheme="http://blog.lehoon.cn/categories/backend/"/>
    
    
      <category term="c++" scheme="http://blog.lehoon.cn/tags/c/"/>
    
      <category term="c" scheme="http://blog.lehoon.cn/tags/c/"/>
    
      <category term="window" scheme="http://blog.lehoon.cn/tags/window/"/>
    
      <category term="service" scheme="http://blog.lehoon.cn/tags/service/"/>
    
  </entry>
  
  <entry>
    <title>汇编指令集</title>
    <link href="http://blog.lehoon.cn/orther/2015/09/21/assembly-instruction.html"/>
    <id>http://blog.lehoon.cn/orther/2015/09/21/assembly-instruction.html</id>
    <published>2015-09-21T15:13:46.000Z</published>
    <updated>2016-07-19T06:51:44.226Z</updated>
    
    <content type="html">&lt;p&gt;汇编指令集详细说明。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;一、数据传送指令&lt;br&gt;1.通用数据传送指令&lt;br&gt;MOV（Move）传送&lt;br&gt;PUSH（Push onto the stack）进栈&lt;br&gt;POP（Pop from the stack）出栈&lt;br&gt;XCHG（Exchange）交换&lt;br&gt;.MOV指令&lt;br&gt;格式为: MOV DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(SRC)&lt;br&gt;.PUSH进栈指令&lt;br&gt;格式为:PUSH SRC&lt;br&gt;执行的操作:(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(SRC)&lt;br&gt;.POP出栈指令&lt;br&gt;格式为:POP DST&lt;br&gt;执行的操作:(DST)&amp;lt;-((SP+1),(SP))&lt;br&gt;(SP)&amp;lt;-(SP)+2&lt;br&gt;.XCHG 交换指令&lt;br&gt;格式为:XCHG OPR1,OPR2&lt;br&gt;执行的操作:(OPR1)&amp;lt;–&amp;gt;(OPR2)&lt;/p&gt;
&lt;p&gt;2.累加器专用传送指令&lt;br&gt;IN(Input) 输入&lt;br&gt;OUT(Output) 输出&lt;br&gt;XLAT(Translate) 换码&lt;br&gt;这组指令只限于使用累加器AX或AL传送信息.&lt;br&gt;.IN 输入指令&lt;br&gt;长格式为: IN AL,PORT(字节)&lt;br&gt;IN AX,PORT(字)&lt;br&gt;执行的操作: (AL)&amp;lt;-(PORT)(字节)&lt;br&gt;(AX)&amp;lt;-(PORT+1,PORT)(字)&lt;br&gt;短格式为: IN AL,DX(字节)&lt;br&gt;IN AX,DX(字)&lt;br&gt;执行的操作: AL&amp;lt;-((DX))(字节)&lt;br&gt;AX&amp;lt;-((DX)+1,DX)(字)&lt;br&gt;.OUT 输出指令&lt;br&gt;长格式为: OUT PORT,AL(字节)&lt;br&gt;OUT PORT,AX(字)&lt;br&gt;执行的操作: (PORT)&amp;lt;-(AL)(字节)&lt;br&gt;(PORT+1,PORT)&amp;lt;-(AX)(字)&lt;br&gt;短格式为: OUT DX,AL(字节)&lt;br&gt;OUT DX,AX(字)&lt;br&gt;执行的操作: ((DX))&amp;lt;-(AL)(字节)&lt;br&gt;((DX)+1,(DX))&amp;lt;-AX(字)&lt;br&gt;在IBM-PC机里,外部设备最多可有65536个I/O端口,&lt;br&gt;端口(即外设的端口地址)为0000~FFFFH.其中前256个端&lt;br&gt;口(0~FFH)可以直接在指令中指定,这就是长格式中的PORT,&lt;br&gt;此时机器指令用二个字节表示,第二个字节就是端口号.所以&lt;br&gt;用长格式时可以在指定中直接指定端口号,但只限于前256个&lt;br&gt;端口.当端口号&amp;gt;=256时,只能使用短格式,此时,必须先把端&lt;br&gt;口号放到DX寄存器中(端口号可以从0000到0FFFFH),然后&lt;br&gt;再用IN或OUT指令来 传送信息.&lt;br&gt;.XLAT 换码指令&lt;br&gt;格式为: XLAT OPR&lt;br&gt;或: XLAT&lt;br&gt;执行的操作:(AL)&amp;lt;-((BX)+(AL))&lt;/p&gt;
&lt;p&gt;3.有效地址送寄存器指令&lt;br&gt;LEA(Load effective address)有效地址送寄存器&lt;br&gt;LDS(Load DS with Pointer)指针送寄存器和DS&lt;br&gt;LES(Load ES with Pointer)指针送寄存器和ES&lt;br&gt;.LEA 有效地址送寄存器&lt;br&gt;格式为: LEA REG,SRC&lt;br&gt;执行的操作:(REG)&amp;lt;-SRC&lt;br&gt;指令把源操作数的有效地址送到指定的寄存器中.&lt;br&gt;.LDS 指针送寄存器和DS指令&lt;br&gt;格式为: LDS REG,SRC&lt;br&gt;执行的操作:(REG)&amp;lt;-(SRC)&lt;br&gt;(DS)&amp;lt;-(SRC+2)&lt;br&gt;把源操作数指定的4个相继字节送到由指令指定的寄存器&lt;br&gt;及DS寄存器中.该指令常指定SI寄存器.&lt;br&gt;.LES 指针送寄存器和ES指令&lt;br&gt;格式为: LES REG,SRC&lt;br&gt;执行的操作: (REG)&amp;lt;-(SRC)&lt;br&gt;(ES)&amp;lt;-(SRC+2)&lt;br&gt;把源操作数指定的4个相继字节送到由指令指定的寄存器&lt;br&gt;及ES寄存器中.该指令常指定DI寄存器.&lt;/p&gt;
&lt;p&gt;4.标志寄存器传送指令&lt;br&gt;LAHF(Load AH with flags)标志送AH&lt;br&gt;SAHF(store AH into flags)AH送标志寄存器&lt;br&gt;PUSHF(push the flags) 标志进栈&lt;br&gt;POPF(pop the flags) 标志出栈&lt;br&gt;.LAHF 标志送AH&lt;br&gt;格式为: LAHF&lt;br&gt;执行的操作:(AH)&amp;lt;-(PWS的低字节)&lt;br&gt;.SAHF AH送标志寄存器&lt;br&gt;格式为: SAHF&lt;br&gt;执行的操作:(PWS的低字节)&amp;lt;-(AH)&lt;br&gt;.PUSHF 标志进栈&lt;br&gt;格式为: PUSHF&lt;br&gt;执行的操作:(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(PSW)&lt;br&gt;.POPF 标志出栈&lt;br&gt;格式为: POPF&lt;br&gt;执行的操作:(PWS)&amp;lt;-((SP)+1,(SP))&lt;br&gt;(SP)&amp;lt;-(SP+2)&lt;/p&gt;
&lt;p&gt;二、算术指令&lt;br&gt;1.加法指令&lt;br&gt;ADD(add)加法&lt;br&gt;ADC(add with carry)带进位加法&lt;br&gt;INC(increment)加1&lt;br&gt;.ADD 加法指令&lt;br&gt;格式: ADD DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(SRC)+(DST)&lt;br&gt;.ADC 带进位加法指令&lt;br&gt;格式: ADC DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(SRC)+(DST)+CF&lt;br&gt;.ADD 加1指令&lt;br&gt;格式: INC OPR&lt;br&gt;执行的操作:(OPR)&amp;lt;-(OPR)+1&lt;/p&gt;
&lt;p&gt;2.减法指令&lt;br&gt;SUB(subtract)减法&lt;br&gt;SBB(subtract with borrow)带借位减法&lt;br&gt;DEC(Decrement)减1&lt;br&gt;NEG(Negate)求补&lt;br&gt;CMP(Compare)比较&lt;br&gt;.SUB 减法指令&lt;br&gt;格式: SUB DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(DST)-(SRC)&lt;br&gt;.SBB 带借位减法指令&lt;br&gt;格式: SBB DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(DST)-(SRC)-CF&lt;br&gt;.DEC 减1指令&lt;br&gt;格式: DEC OPR&lt;br&gt;执行的操作:(OPR)&amp;lt;-(OPR)-1&lt;br&gt;.NEG 求补指令&lt;br&gt;格式: NEG OPR&lt;br&gt;执行的操作:(OPR)&amp;lt;- -(OPR)&lt;br&gt;.CMP 比较指令&lt;br&gt;格式: CMP OPR1,OPR2&lt;br&gt;执行的操作:(OPR1)-(OPR2)&lt;br&gt;该指令与SUB指令一样执行减法操作,但不保存结果,&lt;br&gt;只是根据结果设置条件标志西半球.&lt;/p&gt;
&lt;p&gt;3.乘法指令&lt;br&gt;MUL(Unsigned Multiple)无符号数乘法&lt;br&gt;IMUL(Signed Multiple)带符号数乘法&lt;br&gt;.MUL 无符号数乘法指令&lt;br&gt;格式: MUL SRC&lt;br&gt;执行的操作:&lt;br&gt;字节操作数:(AX)&amp;lt;-(AL)&lt;em&gt;(SRC)&lt;br&gt;字操作数:(DX,AX)&amp;lt;-(AX)&lt;/em&gt;(SRC)&lt;br&gt;.IMUL 带符号数乘法指令&lt;br&gt;格式: IMUL SRC&lt;br&gt;执行的操作:与MUL相同,但必须是带符号数,而MUL是无符号数.&lt;/p&gt;
&lt;p&gt;4.除法指令&lt;br&gt;DIV(Unsigned divide)无符号数除法&lt;br&gt;IDIV(Signed divide)带符号数除法&lt;br&gt;CBW(Convert byte to word)字节转换为字&lt;br&gt;CWD(Contert word to double word)字转换为双字&lt;br&gt;.DIV 无符号数除法指令&lt;br&gt;格式: DIV SRC&lt;br&gt;执行的操作:&lt;br&gt; 字节操作:(AL)&amp;lt;-(AX)/(SRC)的商&lt;br&gt;(AH)&amp;lt;-(AX)/(SRC)的余数&lt;br&gt;字操作: (AX)&amp;lt;-(DX,AX)/(SRC)的商&lt;br&gt;(AX)&amp;lt;-(DX,AX)/(SRC)的余数&lt;br&gt;.IDIV 带符号数除法指令&lt;br&gt;格式: DIV SRC&lt;br&gt;执行的操作:与DIV相同,但操作数必须是带符号数,商和余数&lt;br&gt;也均为带符号数,且余数的符号与被除数的符号相同.&lt;br&gt;.CBW 字节转换为字指令&lt;br&gt;格式: CBW&lt;br&gt;执行的操作:AL的内容符号扩展到AH.即如果(AL)的最高有效&lt;br&gt;位为0,则(AH)=00;如(AL)的最高有效位为1,则(AH)=0FFH&lt;br&gt;.CWD 字转换为双字指令&lt;br&gt;格式: CWD&lt;br&gt;执行的操作:AX的内容符号扩展到DX.即如(AX)的最高有效位&lt;br&gt;为0,则(DX)=0;否则(DX)=0FFFFH.&lt;br&gt;这两条指令都不影响条件码.&lt;/p&gt;
&lt;p&gt;三、逻辑指令&lt;br&gt;1.逻辑运算指令&lt;br&gt;AND(and) 逻辑与&lt;br&gt;OR(or) 逻辑或&lt;br&gt;NOT(not) 逻辑非&lt;br&gt;XOR(exclusive or)异或&lt;br&gt;TEST(test) 测试&lt;br&gt;.AND 逻辑与指令&lt;br&gt;格式: AND DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(DST)^(SRC)&lt;br&gt;.OR 逻辑或指令&lt;br&gt;格式: OR DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(DST)V(SRC)&lt;br&gt;.NOT 逻辑非指令&lt;br&gt;格式: NOT OPR&lt;br&gt;执行的操作:(OPR)&amp;lt;-(OPR)&lt;br&gt;.XOR 异或指令&lt;br&gt;格式: XOR DST,SRC&lt;br&gt;执行的操作:(DST)&amp;lt;-(DST)V(SRC)&lt;br&gt;.TEST 测试指令&lt;br&gt;格式: TEST OPR1,OPR2&lt;br&gt;执行的操作:(DST)^(SRC)&lt;br&gt;两个操作数相与的结果不保存,只根据其特征置条件码&lt;/p&gt;
&lt;p&gt;2.移位指令&lt;br&gt;SHL(shift logical left) 逻辑左移&lt;br&gt;SAL(shift arithmetic left) 算术左移&lt;br&gt;SHR(shift logical right) 逻辑右移&lt;br&gt;SAR(shift arithmetic right) 算术右移&lt;br&gt;ROL(Rotate left) 循环左移&lt;br&gt;ROR(Rotate right) 循环右移&lt;br&gt;RCL(Rotate left through carry) 带进位循环左移&lt;br&gt;RCR(Rotate right through carry) 带进位循环右移&lt;br&gt;格式: SHL OPR,CNT(其余的类似)&lt;br&gt;其中OPR可以是除立即数以外的任何寻址方式.移位次数由CNT决定,&lt;br&gt;CNT可以是1或CL.循环移位指令可以改变操作数中所有位的位置;移&lt;br&gt;位指令则常常用来做乘以2除以2操作.其中算术移位指令适用于带符&lt;br&gt;号数运算,SAL用来乘2,SAR用来除以2;而逻辑移位指令则用来无符&lt;br&gt;号数运算,SHL用来乘2,SHR用来除以2.&lt;/p&gt;
&lt;p&gt;四、串处理指令&lt;br&gt;1.与REP相配合工作的MOVS,STOS和LODS指令&lt;br&gt;.REP重复串操作直到(CX)=0为上&lt;br&gt;格式: REP string primitive&lt;br&gt;其中String Primitive可为MOVS,LODS或STOS指令&lt;br&gt;执行的操作:&lt;br&gt;1)如(CX)=0则退出REP,否则往下执行.&lt;br&gt;2)(CX)&amp;lt;-(CX)-1&lt;br&gt;3)执行其中的串操作&lt;br&gt;4)重复1)~3)&lt;br&gt;.MOVS 串传送指令&lt;br&gt;格式:可有三种&lt;br&gt;MOVS DST,SRC&lt;br&gt;MOVSB(字节)&lt;br&gt;MOVSW(字)&lt;br&gt;其中第二、三种格式明确地注明是传送字节或字，第一种格式则应&lt;br&gt;在操作数中表明是字还是字节操作，例如：&lt;br&gt;MOVS ES:BYTE PTR[DI],DS:[SI]&lt;br&gt;执行的操作:&lt;br&gt;1)((DI))&amp;lt;-((SI))&lt;br&gt;2)字节操作:&lt;br&gt;(SI)&amp;lt;-(SI)+(或-)1,(DI)&amp;lt;-(DI)+(或-)1&lt;br&gt;当方向标志DF=0时用+,当方向标志DF=1时用-&lt;br&gt;3)字操作:&lt;br&gt;(SI)&amp;lt;-(SI)+(或-)2,(DI)&amp;lt;-(DI)+(或-)2&lt;br&gt;当方向标志DF=0时用+,当方向标志DF=1时用-&lt;br&gt;该指令不影响条件码.&lt;br&gt;.CLD(Clear direction flag)该指令使DF=0,在执行串操作&lt;br&gt;指令时可使地址自动增量;&lt;br&gt;.STD(Set direction flag)该指令使DF=1,在执行串操作指&lt;br&gt;令时可使地址自动减量.&lt;br&gt;.STOS 存入串指令&lt;br&gt;格式: STOS DST&lt;br&gt;STOSB(字节)&lt;br&gt;STOSW(字)&lt;br&gt;执行的操作:&lt;br&gt;字节操作:((DI))&amp;lt;-(AL),(DI)&amp;lt;-(DI)+-1&lt;br&gt;字操作: ((DI))&amp;lt;-(AX),(DI)&amp;lt;-(DI)+-2&lt;br&gt;该指令把AL或AX的内容存入由(DI)指定的附加段的某单元中,并根&lt;br&gt;据DF的值及数据类型修改DI的内容,当它与REP联用时,可把AL或AX&lt;br&gt;的内容存入一个长度为(CX)的缓冲区中.&lt;br&gt;.LODS 从串取指令&lt;br&gt;格式: LODS SRC&lt;br&gt;LODSB&lt;br&gt;LODSW&lt;br&gt;执行的操作:&lt;br&gt;字节操作:(AL)&amp;lt;-((SI)),(SI)&amp;lt;-(SI)+-1&lt;br&gt;字操作: (AX)&amp;lt;-((SI)),(SI)&amp;lt;-(SI)+-2&lt;br&gt;该指令把由(SI)指定的数据段中某单元的内容送到AL或AX中,并根据&lt;br&gt;方向标志及数据类型修改SI的内容.指令允许使用段跨越前缀来指定非&lt;br&gt;数据段的存储区.该指令也不影响条件码.一般说来,该指令不和REP联&lt;br&gt;用.有时缓冲区中的一串字符需要逐次取出来测试时,可使用本指令.&lt;/p&gt;
&lt;p&gt;2.与REPE/REPZ和REPNZ/REPNE联合工作的CMPS和SCAS指令&lt;br&gt;.REPE/REPZ 当相等/为零时重复串操作&lt;br&gt;格式: REPE(或REPZ) String Primitive&lt;br&gt;其中String Primitive可为CMPS或SCAS指令.&lt;br&gt;执行的操作:&lt;br&gt;1)如(CX)=0或ZF=0(即某次比较的结果两个操作数不等)时退出,&lt;br&gt;否则往下执行&lt;br&gt;2)(CX)&amp;lt;-(CX)-1&lt;br&gt;3)执行其后的串指令&lt;br&gt;4)重复1)~3)&lt;br&gt;.REPNE/REPNZ 当不相等/不为零时重复串操作&lt;br&gt;格式: REPNE(或REPNZ) String Primitive&lt;br&gt;其中String Primitive可为CMPS或SCAS指令&lt;br&gt;执行的操作:&lt;br&gt;除退出条件(CX=0)或ZF=1外,其他操作与REPE完全相同.&lt;br&gt;.CMPS 串比较指令&lt;br&gt;格式: CMP SRC,DST&lt;br&gt;CMPSB&lt;br&gt;CMPSW&lt;br&gt;执行的操作:&lt;br&gt;1)((SI))-((DI))&lt;br&gt;2)字节操作:(SI)&amp;lt;-(SI)+-1,(DI)&amp;lt;-(DI)+-1&lt;br&gt;字操作: (SI)&amp;lt;-(SI)+-2,(DI)&amp;lt;-(DI)+-2&lt;br&gt;指令把由(SI)指向的数据段中的一个字(或字节)与由(DI)指向的&lt;br&gt;附加段中的一个字(或字节)相减,但不保存结果,只根据结果设置条&lt;br&gt;件码,指令的其它特性和MOVS指令的规定相同.&lt;br&gt;.SCAS 串扫描指令&lt;br&gt;格式: SCAS DST&lt;br&gt;SCASB&lt;br&gt;SCASW&lt;br&gt;执行的操作:&lt;br&gt;字节操作:(AL)-((DI)),(DI)&amp;lt;-(DI)+-1&lt;br&gt;字操作: (AL)-((DI)),(DI)&amp;lt;-(DI)+-2&lt;br&gt;该指令把AL(或AX)的内容与由(DI)指定的在附加段中的一个字节(或字)&lt;br&gt;进行比较,并不保存结果,只根据结果置条件码.指令的其他特性和MOVS的&lt;br&gt;规定相同. &lt;/p&gt;
&lt;p&gt;五、控制转移指令&lt;br&gt;1.无条件转移指令&lt;br&gt;.JMP(jmp) 跳转指令&lt;br&gt;1)段内直接短转移&lt;br&gt;格式:JMP SHORT OPR&lt;br&gt;执行的操作:(IP)&amp;lt;-(IP)+8位位移量&lt;br&gt;2)段内直接近转移&lt;br&gt;格式:JMP NEAR PTR OPR&lt;br&gt;执行的操作:(IP)&amp;lt;-(IP)+16位位移量&lt;br&gt;3)段内间接转移&lt;br&gt;格式:JMP WORD PTR OPR&lt;br&gt;执行的操作:(IP)&amp;lt;-(EA)&lt;br&gt;4)段间直接(远)转移&lt;br&gt;格式:JMP FAR PTR OPR&lt;br&gt;执行的操作:(IP)&amp;lt;-OPR的段内偏移地址&lt;br&gt;(CS)&amp;lt;-OPR所在段的段地址&lt;br&gt;5)段间间接转移&lt;br&gt;格式:JMP DWORD PTR OPR&lt;br&gt;执行的操作:(IP)&amp;lt;-(EA)&lt;br&gt;(CS)&amp;lt;-(EA+2)&lt;br&gt;2.条件转移指令&lt;br&gt;1)根据单个条件标志的设置情况转移&lt;br&gt;.JZ(或JE)(Jump if zero,or equal) 结果为零(或相等)则转移&lt;br&gt;格式:JE(或JZ) OPR&lt;br&gt;测试条件:ZF=1&lt;br&gt;.JNZ(或JNE)(Jump if not zero,or not equal) 结果不为零&lt;br&gt;(或不相等)则转移&lt;br&gt;格式:JNZ(或JNE) OPR&lt;br&gt;测试条件:ZF=0&lt;br&gt;.JS(Jump if sign) 结果为负则转移&lt;br&gt;格式: JS OPR&lt;br&gt;测试条件:SF=1&lt;br&gt;.JNS(Jump if not sign) 结果为正则转移&lt;br&gt;格式:JNS OPR&lt;br&gt;测试条件:SF=0&lt;br&gt;.JO(Jump if overflow) 溢出则转移&lt;br&gt;格式: JO OPR&lt;br&gt;测试条件:OF=1&lt;br&gt;.JNO(Jump if not overflow)&lt;br&gt;不溢出则转移&lt;br&gt;格式: JNO OPR&lt;br&gt;测试条件:OF=0&lt;br&gt;.JP(或JPE)(Jump if parity,or parity even)&lt;br&gt;奇偶位为1则转移&lt;br&gt;格式: JP OPR&lt;br&gt;测试条件:PF=1&lt;br&gt;.JNP(或JPO)(Jump if not parity,or parity odd)&lt;br&gt;奇偶位为0则转移&lt;br&gt;格式: JNP(或JPO) OPR&lt;br&gt;测试条件:PF=0&lt;br&gt;.JB(或JNAE,JC)(Jump if below,or not above or equal,or carry)&lt;br&gt;低于,或者不高于或等于,或进位位为1则转移&lt;br&gt;格式:JB(或JNAE,JC) OPR&lt;br&gt;测试条件:CF=1&lt;br&gt;.JNB(或JAE,JNC)(Jump if not below,or above or equal,or not carry)&lt;br&gt;不低于,或者高于或者等于,或进位位为0则转移&lt;br&gt;格式:JNB(或JAE,JNC) OPR&lt;br&gt;测试条件:CF=0&lt;br&gt;2)比较两个无符号数,并根据比较的结果转移&lt;br&gt;.JB(或JNAE,JC)&lt;br&gt;格式:同上&lt;br&gt;.JNB(或JAE,JNC)&lt;br&gt;格式:同上&lt;br&gt;.JBE(或JNA)(Jump if below or equal,or not above)&lt;br&gt;低于或等于,或不高于则转移&lt;br&gt;格式:JBE(或JNA) OPR&lt;br&gt;测试条件:CFVZF=1&lt;br&gt;.JNBE(或JA)(Jump if not below or equal,or above)&lt;br&gt;不低于或等于,或者高于则转移&lt;br&gt;格式:JNBE(或JA) OPR&lt;br&gt;测试条件:CFVZF=0&lt;br&gt;3)比较两个带符号数,并根据比较的结果转移&lt;br&gt;.JL(或LNGE)(Jump if less,or not greater or equal)&lt;br&gt;小于,或者不大于或者等于则转移&lt;br&gt;格式:JL(或JNGE) OPR&lt;br&gt;测试条件:SFVOF=1&lt;br&gt;.JNL(或JGE)(Jump if not less,or greater or equal)&lt;br&gt;不小于,或者大于或者等于则转移&lt;br&gt;格式:JNL(或JGE) OPR&lt;br&gt;测试条件:SFVOF=0&lt;br&gt;.JLE(或JNG)(Jump if less or equal,or not greater)&lt;br&gt;小于或等于,或者不大于则转移&lt;br&gt;格式:JLE(或JNG) OPR&lt;br&gt;测试条件:(SFVOF)VZF=1&lt;br&gt;.JNLE(或JG)(Jump if not less or equal,or greater)&lt;br&gt;不小于或等于,或者大于则转移&lt;br&gt;格式:JNLE(或JG) OPR&lt;br&gt;测试条件:(SFVOF)VZF=0&lt;br&gt;4)测试CX的值为0则转移指令&lt;br&gt;.JCXZ(Jump if CX register is zero)&lt;br&gt;CX寄存器的内容为零则转移&lt;br&gt;格式:JCXZ OPR&lt;br&gt;测试条件:(CX)=0&lt;br&gt;注:条件转移全为8位短跳!&lt;/p&gt;
&lt;p&gt;3.循环指令&lt;br&gt;.LOOP 循环指令&lt;br&gt;格式: LOOP OPR&lt;br&gt;测试条件:(CX)&amp;lt;&amp;gt;0&lt;br&gt;.LOOPZ/LOOPE 当为零或相等时循环指令&lt;br&gt;格式: LOOPZ(或LOOPE) OPR&lt;br&gt;测试条件:(CX)&amp;lt;&amp;gt;0且ZF=1&lt;br&gt;.LOOPNZ/LOOPNE 当不为零或不相等时循环指令&lt;br&gt;格式: LOOPNZ(或LOOPNE) OPR&lt;br&gt;测试条件:(CX)&amp;lt;&amp;gt;0且ZF=0&lt;br&gt;这三条指令的步骤是:&lt;br&gt;1)(CX)&amp;lt;-(CX)-1&lt;br&gt;2)检查是否满足测试条件,如满足则(IP)&amp;lt;-(IP)+D8的符号扩充.&lt;/p&gt;
&lt;p&gt;4.子程序&lt;br&gt;.CALL调用指令&lt;br&gt;.RET返回指令&lt;br&gt;5.中断&lt;br&gt;.INT指令&lt;br&gt;格式: INT TYPE&lt;br&gt;或 INT&lt;br&gt;执行的操作:(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(PSW)&lt;br&gt;(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(CS)&lt;br&gt;(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(IP)&lt;br&gt;(IP)&amp;lt;-(TYPE&lt;em&gt;4)&lt;br&gt;(CS)&amp;lt;-(TYPE&lt;/em&gt;4+2)&lt;br&gt;.INTO 若溢出则中断&lt;br&gt;执行的操作:若OF=1则:&lt;br&gt;(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(PSW)&lt;br&gt;(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(CS)&lt;br&gt;(SP)&amp;lt;-(SP)-2&lt;br&gt;((SP)+1,(SP))&amp;lt;-(IP)&lt;br&gt;(IP)&amp;lt;-(10H)&lt;br&gt;(CS)&amp;lt;-(12H)&lt;br&gt;.IRET 从中断返回指令&lt;br&gt;格式: IRET&lt;br&gt;执行的操作:(IP)&amp;lt;-((SP)+1,(SP))&lt;br&gt;(SP)&amp;lt;-(SP)+2&lt;br&gt;(CS)&amp;lt;-((SP)+1,(SP))&lt;br&gt;(SP)&amp;lt;-(SP)+2&lt;br&gt;(PSW)&amp;lt;-((SP)+1,(SP))&lt;br&gt;(SP)&amp;lt;-(SP)+2&lt;/p&gt;
&lt;p&gt;六、处理机控制指令&lt;br&gt;1.标志处理指令&lt;br&gt;.CLC进位位置0指令(Clear carry)CF&amp;lt;-0&lt;br&gt;.CMC进位位求反指令(Complement carry)CF&amp;lt;-CF&lt;br&gt;.STC进位位置1指令(Set carry)CF&amp;lt;-1&lt;br&gt;.CLD方向标志置0指令(Clear direction)DF&amp;lt;-0&lt;br&gt;.STD方向标志置1指令(Set direction)DF&amp;lt;-1&lt;br&gt;.CLI中断标志置0指令(Clear interrupt)IF&amp;lt;-0&lt;br&gt;.STI中断标志置1指令(Set interrupt)IF&amp;lt;-0&lt;br&gt;2.其他处理机控制指令&lt;br&gt;NOP(No Opreation) 无操作&lt;br&gt;HLT(Halt) 停机&lt;br&gt;WAIT(Wait) 等待&lt;br&gt;ESC(Escape) 换码&lt;br&gt;LOCK(Lock) 封锁&lt;br&gt;这些指令可以控制处理机状态.这们都不影响条件码.&lt;br&gt;.NOP 无操作指令&lt;br&gt;该指令不执行任何操作,其机器码占有一个字节,在调试程序时往往&lt;br&gt;用这条指令占有一定的存储单元,以便在正式运行时用其他指令取代.&lt;br&gt;.HLT停机指令&lt;br&gt;该指令可使机器暂停工作,使处理机处于停机状态以便等待一次外部&lt;br&gt;中断到来,中断结束后可继续执行下面的程序.&lt;br&gt;.WAIT等待指令&lt;br&gt;该指令使处理机处于空转状态,它也可以用来等待外部中断的发生,&lt;br&gt;但中断结束后仍返回WAIT指令继续德行.&lt;br&gt;.ESC换码指令&lt;br&gt;格式ESC mem&lt;br&gt;其中mem指出一个存储单元,ESC指令把该存储单元的内容送到数据总线去.&lt;br&gt;当然ESC指令不允许使用立即数和寄存器寻址方式.这条指令在使用协处理&lt;br&gt;机(Coprocessor)执行某些操作时,可从存储器指得指令或操作数.协处&lt;br&gt;理机(如8087)则是为了提高速度而可以选配的硬件.&lt;br&gt;.LOCK封锁指令&lt;br&gt;该指令是一种前缀,它可与其他指令联合,用来维持总线的锁存信号直&lt;br&gt;到与其联合的指令执行完为止.当CPU与其他处理机协同工作时,该指令可避&lt;br&gt;免破坏有用信息.&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;汇编指令集详细说明。&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="assembly" scheme="http://blog.lehoon.cn/tags/assembly/"/>
    
  </entry>
  
  <entry>
    <title>bool和BOOL的区别</title>
    <link href="http://blog.lehoon.cn/orther/2015/09/15/bool-BOOL.html"/>
    <id>http://blog.lehoon.cn/orther/2015/09/15/bool-BOOL.html</id>
    <published>2015-09-15T15:05:48.000Z</published>
    <updated>2016-07-19T06:51:50.971Z</updated>
    
    <content type="html">&lt;p&gt;bool 与BOOL的区别.&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;1、类型不同&lt;br&gt;BOOL为int型&lt;br&gt;bool为布尔型&lt;br&gt;2、长度不同&lt;br&gt;bool只有一个字节&lt;br&gt;BOOL长度视实际环境来定，一般可认为是4个字节&lt;br&gt;3、取值不同&lt;br&gt;bool取值false和true，是0和1的区别&lt;br&gt;BOOL取值FALSE和TRUE，是0和非0的区别&lt;/p&gt;
&lt;p&gt;bool是标准C++数据类型，可取值true和false。单独占一个字节，&lt;br&gt;如果数个bool对象列在一起，可能会各占一个bit，这取决于编译器。&lt;/p&gt;
&lt;p&gt;BOOL是微软定义的typedef int BOOL。与bool不同，它是一个三值逻辑，&lt;br&gt;TRUE/FALSE/ERROR，返回值为&amp;gt;0的整数为TRUE，0为FALSE，-1为ERROR。&lt;br&gt;Win32 API中很多返回值为BOOL的函数都是三值逻辑。比如GetMessage().&lt;/p&gt;
&lt;p&gt;大BOOL和小bool之间的区别：&lt;br&gt;1、类型不同&lt;br&gt;BOOL为int型&lt;br&gt;bool为布尔型&lt;br&gt;2、长度不同&lt;br&gt;bool只有一个字节&lt;br&gt;BOOL长度视实际环境来定，一般可认为是4个字节&lt;br&gt;3、取值不同&lt;br&gt;bool取值false和true，是0和1的区别&lt;br&gt;BOOL取值FALSE和TRUE，是0和非0的区别&lt;br&gt;4、例子&lt;br&gt;bool x=3;  //告警&lt;br&gt;bool x=1;  //正确&lt;br&gt;BOOL x=3;  //正确&lt;br&gt;BOOL x=3.3;  //告警&lt;br&gt;注：windows为了兼容问题定义的基础变量。&lt;br&gt;typedef unsigned long        DWORD;&lt;br&gt;typedef int                  BOOL;&lt;br&gt;typedef unsigned char        BYTE;&lt;br&gt;typedef unsigned short      WORD;&lt;br&gt;typedef float                FLOAT;&lt;br&gt;typedef FLOAT                &lt;em&gt;PFLOAT;&lt;br&gt;typedef BOOL near            &lt;/em&gt;PBOOL;&lt;br&gt;typedef BOOL far            &lt;em&gt;LPBOOL;&lt;br&gt;typedef BYTE near            &lt;/em&gt;PBYTE;&lt;br&gt;typedef BYTE far            &lt;em&gt;LPBYTE;&lt;br&gt;typedef int near            &lt;/em&gt;PINT;&lt;br&gt;typedef int far              *LPINT; &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;bool 与BOOL的区别.&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="c++" scheme="http://blog.lehoon.cn/tags/c/"/>
    
      <category term="bool" scheme="http://blog.lehoon.cn/tags/bool/"/>
    
      <category term="BOOL" scheme="http://blog.lehoon.cn/tags/BOOL/"/>
    
  </entry>
  
  <entry>
    <title>ssh限制ip远程登录</title>
    <link href="http://blog.lehoon.cn/orther/2015/08/20/ssh-limit.html"/>
    <id>http://blog.lehoon.cn/orther/2015/08/20/ssh-limit.html</id>
    <published>2015-08-20T10:19:11.000Z</published>
    <updated>2016-07-19T06:52:32.579Z</updated>
    
    <content type="html">&lt;p&gt;在ssh远程登录linux中，限制其他非法的ip登录系统的几种实现方法。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;方法一、&lt;br&gt;在/etc/hosts.allow中添加允许ssh登录的ip地址和网段&lt;br&gt;sshd:192.168.1.2:allow   允许192.168.1.2登录&lt;br&gt;sshd:192.168.1.0/24:allow  允许192.168.1.0~192.168.1.24登录&lt;/p&gt;
&lt;p&gt;在/etc/hosts.deny中添加不允许ssh登录的ip&lt;br&gt;sshd:ALL  出了hosts.allow中允许的，其他都不允许登录&lt;/p&gt;
&lt;p&gt;方法二、&lt;br&gt;使用iptables&lt;br&gt;iptables -A INPUT -p tcp -s 192.168.1.2  –destination-port 22 -j ACCEPT&lt;br&gt;iptables -A INPUT -p tcp –destination-port 22 -j DROP&lt;/p&gt;
&lt;p&gt;方法三、&lt;br&gt;修改sshd_config文件&lt;br&gt;vi /etc/sshd/sshd_config&lt;br&gt;添加一行&lt;br&gt;allowusers root@192.168.1.2&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在ssh远程登录linux中，限制其他非法的ip登录系统的几种实现方法。&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="linux" scheme="http://blog.lehoon.cn/tags/linux/"/>
    
      <category term="ssh" scheme="http://blog.lehoon.cn/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>ultraedit正则表达式使用</title>
    <link href="http://blog.lehoon.cn/orther/2015/08/18/ue-regex.html"/>
    <id>http://blog.lehoon.cn/orther/2015/08/18/ue-regex.html</id>
    <published>2015-08-18T04:33:16.000Z</published>
    <updated>2016-07-19T06:52:29.323Z</updated>
    
    <content type="html">&lt;p&gt;Ultraedit提供了非常丰富的编辑功能,其中非常重要的查找和替换功能一定大家都用过，UltraEdit正则表达式的查找替换功能非常方便和强大，可以在单独文件里面、指定目录下查找替换。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;很多朋友都用过或者正在用UltraEdit，这个编辑器陪伴我也好几年了，从很多地方影响着我写代码的快捷键习惯，Ultraedit提供了非常丰富的编辑功能,其中非常重要的查找和替换功能一定大家都用过，UltraEdit正则表达式的查找替换功能非常方便和强大，可以在单独文件里面、指定目录下查找替换。&lt;/p&gt;
&lt;p&gt;一、正则表达式语法 (UltraEdit Syntax):&lt;br&gt;% 匹配行首 - 表明要搜索的字符串一定在行首.&lt;br&gt;$ 匹配行尾 - 表明要搜索的字符串一定在行尾&lt;br&gt;? 匹配除换行符外的任一单个字符.&lt;br&gt;* 匹配任意个数的字符出现任意次数（不包括换行符）&lt;br&gt;+ 匹配前导字符或者表达式出现一次或者更多次（不包括换行符）&lt;br&gt;++ 匹配前导字符或者表达式不出现或者出现一次以上（不包括换行符）&lt;br&gt;^b 匹配页中断符&lt;br&gt;^p 匹配DOS文件的换行符&lt;br&gt;^r 匹配MAC文件的换行符(CR Only)&lt;br&gt;^n 匹配UNIX文件的换行符 (LF Only)&lt;br&gt;^t 匹配一个制表符&lt;br&gt;[ ] 匹配方括号中的单个的字符&lt;/p&gt;
&lt;p&gt;二、常用正则表达式:&lt;br&gt;删除空行: 替换 %[ ^t]++^p 为 空串&lt;br&gt;删除行尾空格: 替换 [ ^t]+$ 为 空串&lt;br&gt;删除行首空格: 替换 %[ ^t]+ 为 空串&lt;br&gt;每行设置为固定的4个空格开头: 替换 %[ ^t]++^([~ ^t^p]^) 为 “ ^1”&lt;br&gt;每段设置为固定的4个空格开头: 替换 %[ ^t]+ 为 “ “&lt;br&gt;(如果一行是以空格开始的,则视之为一段的开始行)&lt;br&gt;将一段合并为一行: 替换 [ ^t]++^p^([~ ^t^p]^) 为 ^1&lt;br&gt;(注意: 此处假定文本是以DOS方式回车换行 - CR/LF)&lt;br&gt;去掉HTML TAG: 替换 ^{&amp;lt;&lt;em&gt;&amp;gt;^}^{&amp;lt;&lt;/em&gt;^p&lt;em&gt;&amp;gt;^} 为 空串&lt;br&gt;删除HTML中的所有&lt;a&gt;: 替换 &amp;lt;[ ]++a &lt;/a&gt;&lt;/em&gt;[ ]++href[ ]++=*&amp;gt; 为 空串&lt;br&gt;删除文本中指定的前2列字符: 替换 %?? 为 空串&lt;br&gt;在第4列后插入2列空白字符: 替换 %^(????^)^(?^) 为 “^1 ^2”&lt;br&gt;查找所有的数字: [0-9]+[.]++[0-9]+&lt;br&gt;查找所有的单词: [a-z]+&lt;br&gt;查找所有的网址: “&lt;a href=&quot;http://[a-z0-9^~`_./^-^?=&amp;amp;]+”&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://[a-z0-9^~`_./^-^?=&amp;amp;]+”&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;三、语法：&lt;br&gt;1、语法一、&lt;br&gt;符号 功能&lt;br&gt;% 匹配行的开始 - 显示搜索字符串必须在行的开始，但是在所选择的结果字符串中不包括任何行终止字符。&lt;br&gt;$ 匹配行尾 - 显示搜索字符串必须在行尾，但是在所选择的结果字符串中不包括任何行终止字符。&lt;br&gt;? 除了换行符以外匹配任何单个的字符 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;除了换行符匹配任何数量的字符和数字 &lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;前一字符匹配一个或多个，但至少要出现一个&lt;br&gt;++ 前一字符匹配零个或多个，但至少要出现一个&lt;br&gt;^b 匹配一个分页&lt;br&gt;^p 匹配一个换行符(CR/LF)(段)(DOS文件)&lt;br&gt;^r 匹配一个换行符(CR 仅仅)(段)(MAC 文件)&lt;br&gt;^n 匹配一个换行符 ( LF 仅仅 )( 段 )( UNIX 文件 )&lt;br&gt;^t 匹配一个标签字符TAB&lt;br&gt;[] 匹配任何单个的字符，或在方括号中的范围&lt;br&gt;^{A^}^{ B^} 匹配表达式A或 B&lt;br&gt;^ 重载其后的正规表达式字符&lt;br&gt;^(^) 括或标注为用于替换命令的表达式。 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一个正则表达式最多可以有9个标注表达式, 按正规表达式的需要而定。&lt;br&gt;相应的替换表达式是 ^x , 替换范围x是1-9。例如： &lt;/p&gt;
&lt;p&gt;If ^(h&lt;em&gt;o^) ^(f&lt;/em&gt;s^) matches “hello folks”,&lt;br&gt;^2 ^1 would replace it with “folks hello”.&lt;br&gt;（hello folks 将被替换成 folks hello。）&lt;br&gt;注： ^ 是实际字符 ^不是Ctl + 键值。 &lt;/p&gt;
&lt;p&gt;例如：&lt;br&gt;m?n 匹配 “man”,”men”,”min” 但不匹配 “moon”.&lt;br&gt;t*t 匹配 “test”,”tonight” 和 “tea time” (the “tea t” portion) 但不匹配 “tea&lt;br&gt;time” (newline between “tea ” and “time”).&lt;br&gt;Te+st 匹配 “test”,”teest”,” teeeest “等等。但是不匹配 “tst”。&lt;br&gt;[aeiou] 匹配每个小写元音。&lt;br&gt;[,.?] 匹配一文字的 “,”，”.”或 “?”。&lt;br&gt;[0-9, a-z] 匹配任何数位，或小写字母。&lt;br&gt;[~0-9] 除了数字以外匹配任何字符 (~ 意味着”不”)&lt;br&gt;你按如下方式可以查找一个表达式A或 B ：&lt;br&gt;“^{John^}^{Tom^}”&lt;br&gt;这将在找John或Tom的出现。应该在 2 个表达式之间没有任何东西。&lt;br&gt;你可以在同一搜索中按如下方式组合A or B and C or D：&lt;br&gt;“^{John^}^{Tom^}^{Smith^}^{Jones^}”&lt;br&gt;这将在John or Tom 后面找 Smith or Jones。 &lt;/p&gt;
&lt;p&gt;2、语法二：”Unix”句法类型的正则表达式&lt;br&gt;符号 功能&lt;br&gt;\ 标记下一个字符作为一个特殊的字符。&lt;br&gt;“n” 匹配字符”n”。”n” 一个换行符或换行符字符。&lt;br&gt;^ 匹配/定位行的开始。&lt;br&gt;$ 匹配/定位行的尾。 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;匹配前面的字符零次或多次。例 &lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;匹配前面的字符一次或多次。例&lt;br&gt;. 匹配除了一个换行符字符匹配任何单个的字符。&lt;br&gt;(expression)标注用于替换命令的表达式。一个正则表达式根据需要，最多可以有9个标注表达式。相应的代替表达式是 x , x的范围是 1-9 。 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;例如：&lt;br&gt;If (h.&lt;em&gt;o) (f.&lt;/em&gt;s) matches “hello folks”,&lt;br&gt;2 1 would replace it with “folks hello”.&lt;br&gt;（hello folks 将被替换成 folks hello。）&lt;br&gt;[xyz] 一个字符集。匹配在方括号之间的任何字符。&lt;br&gt;[^xyz] 一个否定的字符集。不匹配在方括号之间的任何字符。&lt;br&gt;\d 匹配一个数字字符。等价于[0-9]。&lt;br&gt;\D 匹配一个非数字字符。等价于[^0-9]。&lt;br&gt;\f 匹配一个换页字符。&lt;br&gt;\n 匹配一个换行字符。&lt;br&gt;\r 匹配一个回车符字符。&lt;br&gt;\s 匹配任何空白的空格, 标签, 换页, 包括空格等等，但不匹配换行符。&lt;br&gt;\S 匹配任何非空白的字符，但不匹配换行符。&lt;br&gt;\t 匹配一个标签TAB字符。&lt;br&gt;\v 匹配一个垂直的标签字符。&lt;br&gt;\w 匹配任何词语字符包括下划线。&lt;br&gt;\W 匹配任何非词语字符字符。&lt;br&gt;注： ^ 是实际字符 ^不是Ctl + 键值。&lt;br&gt;例如：&lt;br&gt;m.n 匹配 “man”,”men”,”min” 但不匹配 “moon”.&lt;br&gt;t+t 匹配 “test”,”tonight” 和 “tea time” (the “tea t” portion) 但不匹配 “tea&lt;br&gt;time” (newline between “tea ” and “time”).&lt;br&gt;Te*st 匹配 “test”,”teest”,” teeeest “等等。但是不匹配 “tst”。&lt;br&gt;[aeiou] 匹配每个小写元音。&lt;br&gt;[,.?] 匹配一文字的 “,”，”.”或 “?”。&lt;br&gt;[0-9,a-z] 匹配任何数位，或小写字母。&lt;br&gt;[^0-9] 除了数字以外匹配任何字符 (~ 意味着”不”)&lt;br&gt;你按如下方式可以查找一个表达式A或 B ：&lt;br&gt;“(John)|(Tom)”&lt;br&gt;这将在找John或Tom的出现。应该在 2 个表达式之间没有任何东西。&lt;br&gt;你可以在同一搜索中按如下方式组合A or B and C or D：&lt;br&gt;“(John|Tom) (Smith|Jones)”&lt;br&gt;这将在John or Tom 后面找 Smith or Jones。&lt;br&gt;另外：&lt;br&gt;p 匹配 CR/LF ( 作为 rn 的一样 ) 作为DOS行结束符匹配&lt;br&gt;如果查找/替换功能中正则表达式没有选用，则替换字段中下列字符也是有效的：&lt;br&gt;符号 功能&lt;br&gt;^^ 匹配一个 “^” 字符&lt;br&gt;^s 替换为被选择 ( 加亮 ) 活跃的文件窗口的文章。&lt;br&gt;^c 替换为剪贴板的内容&lt;br&gt;^b 匹配一个页裂缝&lt;br&gt;^p 匹配一个换行符 ( CR/LF )( 段 )( DOS 文件)&lt;br&gt;^r 匹配一个换行符 ( CR 仅仅 )( 段 )( MAC 文件)&lt;br&gt;^n 匹配一个换行符 ( LF 仅仅 )( 段 )( UNIX 文件)&lt;br&gt;^t 匹配一个标签TAB字符&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Ultraedit提供了非常丰富的编辑功能,其中非常重要的查找和替换功能一定大家都用过，UltraEdit正则表达式的查找替换功能非常方便和强大，可以在单独文件里面、指定目录下查找替换。&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://blog.lehoon.cn/categories/orther/"/>
    
    
      <category term="ue" scheme="http://blog.lehoon.cn/tags/ue/"/>
    
      <category term="regex" scheme="http://blog.lehoon.cn/tags/regex/"/>
    
  </entry>
  
</feed>
